# Hanami events

# by Silverswee(e)per

namespace = japan

# Event ids 101-300 reserved

##### Preparation phase (101-108)

# I have started preparing for the hanami - which kind of hanami?
character_event = {
	id = japan.101
	desc = EVTDESC_JAPAN_101
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = sakura_hanami
		clr_character_flag = daytime_hanami
		clr_character_flag = nighttime_hanami
		clr_character_flag = hanami_decorate_capital_event
		clr_character_flag = hanami_capital_decorated
		clr_character_flag = hanami_capital_extremely_decorated
		clr_character_flag = hanami_plain_capital
		clr_character_flag = hanami_offerings_event
		clr_character_flag = hanami_small_offering
		clr_character_flag = hanami_great_offering
		clr_character_flag = hanami_dw_self_sabotage
		clr_character_flag = hanami_dw_sabotage_attempted
		clr_character_flag = hanami_no_offering
		clr_character_flag = hanami_improve_garden_event
		clr_character_flag = hanami_garden_improvement_self
		clr_character_flag = hanami_garden_improvement
		clr_character_flag = hanami_garden_improvement_self_gardener
		clr_character_flag = hanami_weeds
		clr_character_flag = hanami_shirabyoshi_event
		clr_character_flag = hanami_shirabyoshi
		clr_character_flag = hanami_no_entertainers
		clr_character_flag = lavishly_food
		clr_character_flag = medium_food
		clr_character_flag = low_food
		clr_character_flag = sent_invitations
		clr_character_flag = shirabyoshi_noshow
		clr_character_flag = bad_shirabyoshi
		clr_character_flag = inspiring_shirabyoshi
		clr_character_flag = troublesome_shirabyoshi
		clr_character_flag = remarkable_shirabyoshi
		clr_character_flag = banished_shirabyoshi
		clr_character_flag = shirabyoshi_killed
		clr_character_flag = hanami_duel_challengee_won
		clr_character_flag = hanami_duel_draw
		clr_character_flag = hanami_duel_challenger_won
		clr_character_flag = hanami_in_progress
		clr_character_flag = hanami_good_weather
		clr_character_flag = hanami_shirabyoshi_duel_hold_back
		clr_character_flag = hanami_shirabyoshi_duel_fair_fight
		clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
		clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
		clr_character_flag = hanami_brave
		clr_character_flag = hanami_not_craven
		clr_character_flag = hanami_prestige
		clr_character_flag = hanami_wounded
		clr_character_flag = hanami_duelist
		clr_character_flag = do_not_disturb
		any_vassal = {
			limit = {
				has_character_flag = guest_hanami_started
			}
			clr_character_flag = coming_to_hanami
			clr_character_flag = guest_hanami_started
			clr_character_flag = hanami_shirabyoshi_duel_hold_back
			clr_character_flag = hanami_shirabyoshi_duel_fair_fight
			clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
			clr_character_flag = hanami_brave
			clr_character_flag = hanami_not_craven
			clr_character_flag = hanami_prestige
			clr_character_flag = hanami_wounded
			clr_character_flag = hanami_duelist
			clr_character_flag = shirabyoshi_dueller
		}
		any_courtier = {
			clr_character_flag = coming_to_hanami
			clr_character_flag = guest_hanami_started
			clr_character_flag = hanami_shirabyoshi_duel_hold_back
			clr_character_flag = hanami_shirabyoshi_duel_fair_fight
			clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
			clr_character_flag = hanami_brave
			clr_character_flag = hanami_not_craven
			clr_character_flag = hanami_prestige
			clr_character_flag = hanami_wounded
			clr_character_flag = hanami_duelist
			clr_character_flag = shirabyoshi_dueller
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_101 # Let the preparations begin!
		
		set_character_flag = sakura_hanami
		
		character_event = { id = japan.102 days = 1 } # Pick day or night celebration
		
		ai_chance = {
			factor = 75
			modifier = {
				factor = 10
				NOT = {
					age = 35
				}
			}
		}
	}
}

# Day or night hanami?
character_event = {
	id = japan.102
	desc = EVTDESC_JAPAN_102
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_102 # Day
		
		set_character_flag = daytime_hanami
		
		hidden_tooltip = {
			random_list = {
				25 = {
					character_event = { id = japan.103 days = 5} # Hire Shirabyoshi?
					set_character_flag = hanami_shirabyoshi_event
				}
				25 = {
					character_event = { id = japan.104 days = 5} # Decorate capital?
					set_character_flag = hanami_decorate_capital_event
				}
				25 = {
					character_event = { id = japan.105 days = 5} # Send offerings to shrines? - DW side event!
					set_character_flag = hanami_offerings_event
				}
				25 = {
					character_event = { id = japan.107 days = 5} # Improve the garden?
					set_character_flag = hanami_improve_garden_event
				}
			}
			
			random_list = {
				25 = {
					modifier = {
						factor = 0
						has_character_flag = hanami_shirabyoshi_event
					}
					character_event = { id = japan.103 days = 10} # Hire Shirabyoshi?
					set_character_flag = hanami_shirabyoshi_event
				}
				25 = {
					modifier = {
						factor = 0
						has_character_flag = hanami_decorate_capital_event
					}
					character_event = { id = japan.104 days = 10} # Decorate capital?
					set_character_flag = hanami_decorate_capital_event
				}
				25 = {
					modifier = {
						factor = 0
						has_character_flag = hanami_offerings_event
					}
					character_event = { id = japan.105 days = 10} # Send offerings to shrines? - DW side event!
					set_character_flag = hanami_offerings_event
				}
				25 = {
					modifier = {
						factor = 0
						has_character_flag = hanami_improve_garden_event
					}
					character_event = { id = japan.107 days = 10} # Improve the garden?
					set_character_flag = hanami_improve_garden_event
				}
				100 = {} # No random event
			}
		}
		
		character_event = { id = japan.108 days = 15 } # Food preparations
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_102 # Night (yozakura)
		
		set_character_flag = nighttime_hanami
		
		hidden_tooltip = {
			random_list = {
				25 = {
					character_event = { id = japan.103 days = 5} # Hire Shirabyoshi?
					set_character_flag = hanami_shirabyoshi_event
				}
				25 = {
					character_event = { id = japan.104 days = 5} # Decorate capital?
					set_character_flag = hanami_decorate_capital_event
				}
				25 = {
					character_event = { id = japan.105 days = 5} # Send offerings to shrines? - DW side event!
					set_character_flag = hanami_offerings_event
				}
				25 = {
					character_event = { id = japan.107 days = 5} # Improve the garden?
					set_character_flag = hanami_improve_garden_event
				}
			}
			
			random_list = {
				25 = {
					modifier = {
						factor = 0
						has_character_flag = hanami_shirabyoshi_event
					}
					character_event = { id = japan.103 days = 10} # Hire Shirabyoshi?
					set_character_flag = hanami_shirabyoshi_event
				}
				25 = {
					modifier = {
						factor = 0
						has_character_flag = hanami_decorate_capital_event
					}
					character_event = { id = japan.104 days = 10} # Decorate capital?
					set_character_flag = hanami_decorate_capital_event
				}
				25 = {
					modifier = {
						factor = 0
						has_character_flag = hanami_offerings_event
					}
					character_event = { id = japan.105 days = 10} # Send offerings to shrines? - DW side event!
					set_character_flag = hanami_offerings_event
				}
				25 = {
					modifier = {
						factor = 0
						has_character_flag = hanami_improve_garden_event
					}
					character_event = { id = japan.107 days = 10} # Improve the garden?
					set_character_flag = hanami_improve_garden_event
				}
				100 = {} # No random event
			}
		}
		
		ai_chance = {
			factor = 25
		}
	}
}

# Hire shirabyoshi?
character_event = {
	id = japan.103
	desc = EVTDESC_JAPAN_103
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	option = {
		trigger = {
			wealth = 25
		}
		name = EVTOPTA_JAPAN_103 # Hire shirabyoshi
		
		set_character_flag = hanami_shirabyoshi
		
		wealth = -25
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.2
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_103 # Let's not
		
		set_character_flag = hanami_no_entertainers
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					trait = greedy
				}
				wealth = 25
			}
		}
	}
}

# Decorate the capital?
character_event = {
	id = japan.104
	desc = EVTDESC_JAPAN_104
	picture = GFX_evt_market
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			wealth = 10
		}
		name = EVTOPTA_JAPAN_104 # Decorate the capital
		
		set_character_flag = hanami_capital_decorated
		
		wealth = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.2
				trait = greedy
			}
		}
	}
	
	option = {
		trigger = {
			wealth = 50
		}
		
		name = EVTOPTB_JAPAN_104 # Decorate the capital extensively!
		
		set_character_flag = hanami_capital_extremely_decorated
		
		wealth = -50
		
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			custom_tooltip = {
				text = capital_prospers_custom_tooltip
				hidden_tooltip = {
					capital_scope = {
						change_variable = { which = prosperity_value value = 8 }
					}
				}
			}
		}
		capital_scope = {
			add_province_modifier = {
				modifier = hanami_decorations
				months = 12
			}
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_104 # Nah
		
		set_character_flag = hanami_plain_capital
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					trait = greedy
				}
				wealth = 25
			}
		}
	}
}

# Send offerings to shrines?
character_event = {
	id = japan.105
	desc = EVTDESC_JAPAN_105
	picture = GFX_evt_tribal_shrine
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			wealth = 10
		}
		name = EVTOPTA_JAPAN_105 # Make a small offering
		
		set_character_flag = hanami_small_offering
		
		wealth = -10
		piety = 5
		
		hidden_tooltip = {
			random = {
				chance = 25
				random_realm_character = {
					limit = {
						society_member_of = the_ghost_gatherers
						NOT = {
							character = ROOT
						}
						NOT = {
							distance = {
								who = ROOT
								distance = 250
							}
						}
						is_inaccessible_or_incapable_trigger = no
						prisoner = no
					}
					save_event_target_as = hanami_dw_sabotager
					character_event = { id = japan.106 } # Sabotage the offerings?
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.2
				trait = greedy
			}
			modifier = {
				factor = 0.2
				trait = cynical
			}
			modifier = {
				factor = 0
				society_member_of = the_ghost_gatherers
			}
		}
	}
	
	option = {
		trigger = {
			wealth = 25
		}
		name = EVTOPTB_JAPAN_105 # Make a great offering
		
		set_character_flag = hanami_great_offering
		
		wealth = -25
		piety = 10
		
		hidden_tooltip = {
			random = {
				chance = 25
				random_realm_character = {
					limit = {
						society_member_of = the_ghost_gatherers
						NOT = {
							character = ROOT
						}
						NOT = {
							distance = {
								who = ROOT
								distance = 250
							}
						}
						is_inaccessible_or_incapable_trigger = no
						prisoner = no
					}
					save_event_target_as = hanami_dw_sabotager
					character_event = { id = japan.106 } # Sabotage the offerings?
				}
			}
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				trait = greedy
			}
			modifier = {
				factor = 0
				trait = cynical
			}
			modifier = {
				factor = 100
				trait = zealous
			}
			modifier = {
				factor = 0
				society_member_of = the_ghost_gatherers
			}
		}
	}
	
	option = {
		trigger = {
			society_member_of = the_ghost_gatherers
			wealth = 10
		}
		
		name = EVTOPTC_JAPAN_105 # Oh, I know just what to send...
		
		wealth = -10
		
		set_character_flag = hanami_dw_self_sabotage
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = greedy
			}
			modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTD_JAPAN_105 # Nah
		
		set_character_flag = hanami_no_offering
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					trait = greedy
					trait = cynical
				}
				wealth = 10
			}
		}
	}
}

# DW - try to sabotage offerings?
character_event = {
	id = japan.106
	desc = EVTDESC_JAPAN_106
	picture = GFX_evt_tribal_shrine
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_106 # Attempt to sabotage the offerings
		detract_society_currency_trivial_effect = yes
		
		FROM = {
			set_character_flag = hanami_dw_sabotage_attempted
		}
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_106 # Attempt to sabotage the offerings
		
		ai_chance = {
			factor = 25
		}
	}
}

# Improve the garden?
character_event = {
	id = japan.107
	desc = EVTDESC_JAPAN_107
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = gardener
			}
			wealth = 10
		}
		
		name = EVTOPTA_JAPAN_107 # Deal with it yourself
		
		set_character_flag = hanami_garden_improvement_self
		
		wealth = -10
		
		if = {
			limit = {
				NOT = {
					lifestyle_traits = 1
				}
			}
			random = {
				chance = 15
				add_trait = gardener
				set_character_flag = hanami_garden_improvement_self_gardener
				clr_character_flag = hanami_garden_improvement_self
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.1
				trait = slothful
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				NOT = {
					trait = gardener
				}
				trait = slothful
			}
			wealth = 25
		}
		
		name = EVTOPTB_JAPAN_107 # Hire someone to deal with it for you
		
		set_character_flag = hanami_garden_improvement
		
		wealth = -25
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.1
				trait = slothful
			}
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
	
	option = {
		trigger = {
			trait = gardener
		}
		
		name = EVTOPTC_JAPAN_107 # Deal with it yourself
		
		set_character_flag = hanami_garden_improvement_self_gardener
		
		prestige = 25
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				trait = slothful
			}
		}
	}
	
	option = {
		name = EVTOPTD_JAPAN_107 # Nah
		
		set_character_flag = hanami_weeds
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					trait = greedy
					trait = slothful
				}
				wealth = 10
			}
		}
	}
}

# Food preparations - vanilla code
character_event = {
	id = japan.108
	desc = EVTDESC_JAPAN_108
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes

	trigger = {
		has_character_modifier = hanami_in_progress
		NOT = {
			has_character_flag = lavishly_food
		}
		NOT = {
			has_character_flag = medium_food
		}
		NOT = {
			has_character_flag = low_food
		}
	}

	option = {
		name = "EVTOPTA72003" #Spend lavishly on food
		gain_weight_small_effect = yes
		weight_trait_check_effect = yes
		trigger = { NOT = { trait = temperate } }
		ai_chance = {

			factor = 30

			modifier = {
				factor = 0.5
				trait = greedy
			}
			modifier = {
				factor = 3
				trait = gluttonous
			}
			modifier = {
				factor = 0.1
				trait = temperate
			}
			modifier = {
				factor = 2
				primary_title = { higher_tier_than = DUKE }
			}
		}
		set_character_flag = lavishly_food
		treasury = -20
		prestige = 10
		hidden_tooltip = {
			character_event = {	id = japan.109 days = 5 } # Invite people
		}
	}
	option = {
		name = "EVTOPTB72003" #Spend medium on food
		ai_chance = {
			factor = 30

			modifier = {
				factor = 0.5
				NOT = { trait = greedy }
			}
			modifier = {
				factor = 2
				NOT = { trait = gluttonous }
			}
			modifier = {
				factor = 2
				primary_title = { tier = DUKE }
			}
		}
		set_character_flag = medium_food
		treasury = -10
		hidden_tooltip = {
			character_event = {	id = japan.109 days = 5 } # Invite people
		}
	}
	option = {
		name = "EVTOPTC72003" #Spend low on food
		trigger = { NOT = { trait = gluttonous } }
		ai_chance = {
			factor = 30

			modifier = {
				factor = 2.5
				trait = greedy
			}
			modifier = {
				factor = 0.1
				trait = gluttonous
			}
			modifier = {
				factor = 2
				primary_title = { tier = COUNT }
			}
		}
		set_character_flag = low_food
		treasury = -5
		prestige = -5
		hidden_tooltip = {
			character_event = {	id = japan.109 days = 5 } # Invite people
		}
	}
}

##### Invitations (based on vanilla logic) (109-111)

# Time to send out invitations
character_event = {
	id = japan.109
	desc = EVTDESC_JAPAN_109
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	trigger = {
		has_character_modifier = hanami_in_progress
		OR = {
			has_character_flag = lavishly_food
			has_character_flag = medium_food
			has_character_flag = low_food
		}
		NOT = {
			has_character_flag = sent_invitations
		}
	}
	
	option = {
		name = "EVTOPTA72010"
		set_character_flag = sent_invitations
		custom_tooltip = {
			text = EVTTOOLTIP1_RoI_1000
		}
		hidden_tooltip = {
			narrative_event = { id = japan.112 days = 20 }
			any_vassal = {
				limit = {
					NOT = { is_inaccessible_trigger = yes }
					prisoner = no
					NOT = { has_character_flag = do_not_disturb }
					NOT = { trait = incapable }
					NOT = { has_character_modifier = hanami_in_progress }
					war = no
					is_adult = yes
				}
				letter_event = {
					id = japan.110
					days = 2
					#tooltip = "EVTTOOLTIP72011"
				}
			}
		}
	}
}

# Vassal gets invitation
letter_event = {
	id = japan.110
	desc = EVTDESC_JAPAN_110

	is_triggered_only = yes

	trigger = { NOT = { is_inaccessible_trigger = yes } }

	option = {
		name = EVTOPTA_JAPAN_110 # Travel to the hanami
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				opinion = { who = from value = -40 }
			}
			modifier  = {
				factor = 2
				opinion = { who = from value = -20 }
			}
		}
		set_character_flag = coming_to_hanami
	}
	option = {
		name = EVTOPTB_JAPAN_110 # Refuse
		ai_chance = {
			factor = 1
			modifier  = {
				factor = 2
				NOT = { opinion = { who = from value = -60 } }
			}
			modifier  = {
				factor = 2
				NOT = { opinion = { who = from value = -80 } }
			}
		}
		FROM = {
			letter_event = {
				id = japan.111
				days = 1
				random = 2
				tooltip = "EVTTOOLTIP72012"
			}
		}
	}
}

# Vassal refused invitation
letter_event = {
	id = japan.111
	desc = EVTDESC_JAPAN_111

	is_triggered_only = yes

	option = {
		name = "EVTOPTA72012"
		opinion = {
			modifier = opinion_dislike
			who = FROM
			years = 10
		}
	}
}

##### Events on arrival (112-115)

# Guests arrive
narrative_event = {
	id = japan.112
	title = EVTTITLE_JAPAN_112
	border = GFX_event_narrative_frame_diplomacy
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes

	trigger = {
		has_character_modifier = hanami_in_progress
		has_character_flag = sent_invitations
		NOT = {
			has_character_flag = host_hanami_started
		}
		any_vassal = {
			NOT = {
				has_character_flag = guest_hanami_started
			}
			has_character_flag = coming_to_hanami
		}
	}
	
	desc = {
		trigger = {
			has_character_flag = sakura_hanami
			has_character_flag = daytime_hanami
		}
		text = EVTDESCA_JAPAN_112
		picture = GFX_evt_garden
	}
	desc = {
		trigger = {
			has_character_flag = sakura_hanami
			has_character_flag = nighttime_hanami
		}
		text = EVTDESCB_JAPAN_112
		picture = GFX_evt_shadowy_cabal
	}
	
	option = {
		name = EVTOPTA_JAPAN_112 # Welcome the guests
		
		set_character_flag = host_hanami_started
		
		# Select random events
		hidden_tooltip = {
			any_vassal = {
				limit = {
					has_character_flag = coming_to_hanami
				}
				set_character_flag = guest_hanami_started
			}
			any_vassal = {
				limit = {
					ai = no # No need to spam the AI
					has_character_flag =  coming_to_hanami
				}
				narrative_event = { id = japan.113 }
			}
			
			### Event group 1 - 3-9 days into the hanami (116-175)
			
			# Decoration events
			if = {
				limit = {
					has_character_flag = hanami_decorate_capital_event
				}
				random_list = {
					25 = {
						modifier = {
							factor = 0
							has_character_flag = hanami_plain_capital
						}
						modifier = {
							factor = 5
							has_character_flag = hanami_capital_extremely_decorated
						}
						random_vassal = {
							limit = {
								has_character_flag =  coming_to_hanami
							}
							character_event = { id = japan.116 days = 3 random = 3 } # Capital decorations impresses guest
						}
					}
					25 = {
						modifier = {
							factor = 0
							has_character_flag = hanami_capital_extremely_decorated
						}
						modifier = {
							factor = 5
							has_character_flag = hanami_plain_capital
						}
						random_vassal = {
							limit = {
								has_character_flag =  coming_to_hanami
							}
							character_event = { id = japan.118 days = 3 random = 3 } # Lack of decorations upsets guest
						}
					}
					75 = {}
				}
			}
			
			# Offerings sent to shrine
			if = {
				limit = {
					has_character_flag = hanami_offerings_event
				}
				random_list = {
					25 = {
						modifier = {
							factor = 0
							OR = {
								has_character_flag = hanami_no_offering
								has_character_flag = hanami_dw_self_sabotage
								has_character_flag = hanami_dw_sabotage_attempted
							}
						}
						modifier = {
							factor = 5
							has_character_flag = hanami_great_offering
						}
						modifier = {
							factor = 0
							NOT = {
								any_vassal = {
									has_character_flag =  coming_to_hanami
									religion = shinto
									NOT = {
										trait = cynical
									}
								}
							}
						}
						random_vassal = {
							limit = {
								has_character_flag =  coming_to_hanami
								religion = shinto
								NOT = {
									trait = cynical
								}
							}
							character_event = { id = japan.120 days = 3 random = 3 } # Vassal impressed by offering
						}
					}
					25 = {
						modifier = {
							factor = 0
							OR = {
								has_character_flag = hanami_great_offering
								has_character_flag = hanami_dw_self_sabotage
								has_character_flag = hanami_dw_sabotage_attempted
							}
						}
						modifier = {
							factor = 5
							has_character_flag = hanami_no_offering
						}
						random_vassal = {
							limit = {
								has_character_flag =  coming_to_hanami
								religion = shinto
								NOT = {
									trait = cynical
								}
							}
							character_event = { id = japan.122 days = 3 random = 3 } # Vassal upset over lack of offering
						}
					}
					25 = {
						modifier = {
							factor = 0
							NOR = {
								has_character_flag = hanami_dw_self_sabotage
								has_character_flag = hanami_dw_sabotage_attempted
							}
						}
						modifier = {
							factor = 5
							has_character_flag = hanami_dw_self_sabotage
						}
						if = {
							limit = {
								has_character_flag = hanami_dw_self_sabotage
							}
							character_event = { id = japan.124 days = 3 random = 3 } # Determine how the sabotage went
						}
						if = {
							limit = {
								NOT = {
									has_character_flag = hanami_dw_self_sabotage
								}
							}
							event_target:hanami_dw_sabotager = {
								character_event = { id = japan.128 days = 3 random = 3 } # Determine how the sabotage went
							}
						}
					}
					75 = {}
				}
			}
			
			# Garden improved (or not)
			if = {
				limit = {
					has_character_flag = hanami_improve_garden_event
				}
				random_list = {
					25 = {
						modifier = {
							factor = 0
							has_character_flag = hanami_weeds
						}
						modifier = {
							factor = 5
							has_character_flag = hanami_garden_improvement_self_gardener
						}
						random_vassal = {
							limit = {
								has_character_flag =  coming_to_hanami
							}
							character_event = { id = japan.133 days = 3 random = 3 } # Garden improvement impresses guest
						}
					}
					25 = {
						modifier = {
							factor = 0
							has_character_flag = hanami_garden_improvement_self_gardener
						}
						modifier = {
							factor = 5
							has_character_flag = hanami_weeds
						}
						random_vassal = {
							limit = {
								has_character_flag =  coming_to_hanami
							}
							character_event = { id = japan.135 days = 3 random = 3 } # Bad garden improvement upsets guest
						}
					}
					75 = {}
				}
			}
			
			# Entertainment 1
			if = {
				limit = {
					has_character_flag = hanami_shirabyoshi_event
				}
				if = {
					limit = {
						has_character_flag = hanami_no_entertainers
					}
					random = {
						chance = 75
						random_vassal = {
							limit = {
								has_character_flag =  coming_to_hanami
							}
							character_event = { id = japan.137 days = 3 random = 3 } # Guest complains about lack of entertainment
						}
					}
				}
				if = {
					limit = {
						has_character_flag = hanami_shirabyoshi
					}
					random_list = {
						10 = {
							character_event = { id = japan.139 days = 6 random = 3 } # Shirabyoshi do not show up
						}
						20 = {
							character_event = { id = japan.141 days = 6 random = 3 } # Shirabyoshi perform poorly
						}
						20 = {
							modifier = {
								factor = 0
								NOT = {
									any_dynasty_member = {
										is_female = yes
										age = 6
										NOT = {
											age = 16
										}
										NOR = {
											trait = shy
											trait = brooding
										}
										prisoner = no
										is_inaccessible_or_incapable_trigger = no
										host = {
											character = ROOT
										}
										NOT = {
											has_character_flag = inspired_by_shirabyoshi
										}
									}
								}
							}
							set_character_flag = inspiring_shirabyoshi
							random_dynasty_member = {
								limit = {
									is_female = yes 
									age = 6
									NOT = {
										age = 16
									}
									NOR = {
										trait = shy
										trait = brooding
									}
									prisoner = no
									is_inaccessible_or_incapable_trigger = no
									host = {
										character = ROOT
									}
								}
								character_event = { id = japan.143 days = 6 random = 3 } # Shirabyoshi inspire your kinswoman
							}
						}
						10 = {
							modifier = {
								factor = 0
								NOR = {
									any_vassal = {
										is_adult = yes
										has_character_flag =  coming_to_hanami
										OR = {
											is_female = no
											ROOT = {
												primary_title = {
													has_law = status_of_women_3
												}
											}
										}
									}
									any_courtier = {
										is_adult = yes
										is_inaccessible_or_incapable_trigger = no
										prisoner = no
										OR = {
											is_female = no
											ROOT = {
												primary_title = {
													has_law = status_of_women_3
												}
											}
										}
									}
								}
							}
							create_character = {
								age = 25
								culture = japanese
								religion = shinto
								random_traits = yes
								female = yes
								attributes = {
									diplomacy = 6
									martial = 8
									stewardship = 4
									intrigue = 2
									learning = 8
								}
							}
							new_character = {
								remove_trait = slow
								remove_trait = imbecile
								remove_trait = dull
								remove_trait = clubfooted
								remove_trait = harelip
								remove_trait = hunchback
								remove_trait = lisp
								remove_trait = stutter
								remove_trait = ugly
								remove_trait = dwarf
								remove_trait = inbred
								remove_trait = weak
								remove_lifestyle_trait_effect = yes
								add_trait = duelist
								save_event_target_as = troublesome_shirabyoshi
								set_character_flag = ai_flag_refuse_concubinage
								set_character_flag = ai_flag_refuse_marriage
							}
							set_character_flag = troublesome_shirabyoshi
							random_list = {
								50 = {
									random_vassal = {
										limit = {
											is_adult = yes
											has_character_flag =  coming_to_hanami
											is_ill_trigger = no
											has_symptom_trigger = no
											is_maimed_trigger = no
											OR = {
												is_female = no
												ROOT = {
													primary_title = {
														has_law = status_of_women_3
													}
												}
											}
										}
										set_character_flag = shirabyoshi_dueller
										character_event = { id = japan.145 days = 6 random = 3 } # Vassal gets option to duel shirabyoshi
									}
								}
								50 = {
									random_courtier = {
										limit = {
											is_adult = yes
											is_inaccessible_or_incapable_trigger = no
											prisoner = no
											is_ill_trigger = no
											has_symptom_trigger = no
											is_maimed_trigger = no
											OR = {
												is_female = no
												ROOT = {
													primary_title = {
														has_law = status_of_women_3
													}
												}
											}
										}
										set_character_flag = shirabyoshi_dueller
										character_event = { id = japan.145 days = 6 random = 3 } # Vassal gets option to duel shirabyoshi
									}
								}
							}
						}
						10 = {
							create_character = {
								age = 25
								culture = japanese
								religion = shinto
								random_traits = yes
								female = yes
								attributes = {
									diplomacy = 10
									martial = 12
									stewardship = 8
									intrigue = 4
									learning = 10
								}
							}
							new_character = {
								remove_trait = slow
								remove_trait = imbecile
								remove_trait = dull
								remove_trait = clubfooted
								remove_trait = harelip
								remove_trait = hunchback
								remove_trait = lisp
								remove_trait = stutter
								remove_trait = ugly
								remove_trait = dwarf
								remove_trait = inbred
								remove_trait = weak
								save_event_target_as = remarkable_shirabyoshi
								set_character_flag = ai_flag_refuse_concubinage
								set_character_flag = ai_flag_refuse_marriage
							}
							set_character_flag = remarkable_shirabyoshi
							character_event = { id = japan.174 days = 6 random = 3 } # Remarkable shirabyoshi
						}
						20 = {}
					}
				}
			}
			
			character_event = { id = japan.320 days = 10 } # Second group of events
			
			character_event = { id = japan.322 days = 30 } # Inform liege that the hanami is over
		}
	}
}

# Guest welcomed
narrative_event = {
	id = japan.113
	title = EVTTITLE_JAPAN_113
	border = GFX_event_narrative_frame_diplomacy
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	desc = {
		trigger = {
			FROM = {
				has_character_flag = sakura_hanami
				has_character_flag = daytime_hanami
			}
		}
		text = EVTDESCA_JAPAN_113
		picture = GFX_evt_garden
	}
	desc = {
		trigger = {
			FROM = {
				has_character_flag = sakura_hanami
				has_character_flag = nighttime_hanami
			}
		}
		text = EVTDESCB_JAPAN_113
		picture = GFX_evt_shadowy_cabal
	}
	
	option = {
		name = EVTOPTA_JAPAN_113 # This should be fun!
	}
}

# Guest approves - obsolete
#character_event = {
#	id = japan.114
#	desc = EVTDESC_JAPAN_114
#	picture = GFX_evt_feast
#	
#	is_triggered_only = yes
#	
#	option = {
#		name = EVTOPTA_JAPAN_114
#		prestige = 5
#	}
#}

# Guest disapproves - obsolete
#character_event = {
#	id = japan.115
#	desc = EVTDESC_JAPAN_115
#	picture = GFX_evt_feast
#	
#	is_triggered_only = yes
#	
#	option = {
#		name = EVTOPTA_JAPAN_115
#		
#		opinion = {
#			who = FROM
#			modifier = hanami_disapproval_2
#			months = 12
#		}
#	}
#}

##### Event group 1 (116-175)

### Decorations (116-119)

# Vassal impressed
character_event = {
	id = japan.116
	desc = EVTDESC_JAPAN_116
	picture = GFX_evt_market

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_116 # I like it!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = japan.117 } # Inform liege
		}
	}
}

# Decorations impress vassal
character_event = {
	id = japan.117
	desc = EVTDESC_JAPAN_117
	picture = GFX_evt_market

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_117 # Good to hear!
		
		prestige = 25
	}
}

# Lack of decorations upset vassal
character_event = {
	id = japan.118
	desc = EVTDESC_JAPAN_118
	picture = GFX_evt_market

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_118 # I don't like it!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = japan.119 } # Inform liege
		}
	}
}

# Vassal upset
character_event = {
	id = japan.119
	desc = EVTDESC_JAPAN_119
	picture = GFX_evt_market

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_119 # Unfortunate
		
		prestige = -25
	}
}

### Offerings sent to shrines (120-132)

# Vassal informed of offerings
character_event = {
	id = japan.120
	desc = EVTDESC_JAPAN_120
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		trigger = {
			true_religion = shinto
			NOT = {
				trait = cynical
			}
		}
		
		name = EVTOPTA_JAPAN_120 # Most impressive!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = japan.121 } # Inform liege
		}
	}
	
	option = {
		trigger = {
			OR = {
				NOT = {
					true_religion = shinto
				}
				trait = cynical
			}
		}
		
		name = EVTOPTB_JAPAN_120 # Let's pretend we're impressed!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = japan.121 } # Inform liege
		}
	}
}

# Offerings impress vassal
character_event = {
	id = japan.121
	desc = EVTDESC_JAPAN_121
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_121 # Good to hear!
		
		piety = 25
	}
}

# Small/no offerings upset vassal
character_event = {
	id = japan.122
	desc = EVTDESC_JAPAN_122
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		trigger = {
			true_religion = shinto
			NOT = {
				trait = cynical
			}
		}
		name = EVTOPTA_JAPAN_122 # I don't like it!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = japan.123 } # Inform liege
		}
	}
	
	option = {
		trigger = {
			OR = {
				NOT = {
					true_religion = shinto
				}
				trait = zealous
			}
		}
		name = EVTOPTB_JAPAN_122 # Pretend to be outraged
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = japan.123 } # Inform liege
		}
	}
}

# Vassal upset
character_event = {
	id = japan.123
	desc = EVTDESC_JAPAN_123
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_123 # Unfortunate
		
		piety = -25
	}
}

# DW offering self-sabotage - check outcome
character_event = {
	id = japan.124
	hide_window = yes
	is_triggered_only = yes

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		society_member_of = the_ghost_gatherers
	}
	
	immediate = {
		random_list = {
			33 = {
				modifier = {
					factor = 2
					intrigue = 28
				}
				modifier = {
					factor = 2
					intrigue = 24
				}
				modifier = {
					factor = 2
					intrigue = 20
				}
				character_event = { id = japan.125 } # Sabotage went well
			}
			34 = {
				character_event = { id = japan.126 } # Sabotage discovered, but not who did it
			}
			33 = {
				modifier = {
					factor = 2
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 4
					}
				}
				character_event = { id = japan.127 } # Sabotage discovered, suspicion increased
			}
		}
	}
}

# Sabotage went well - not discovered
character_event = {
	id = japan.125
	desc = EVTDESC_JAPAN_125
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_125 # Just as planned!
		
		add_society_currency_minor_effect = yes
		
		religion_authority = {
			modifier = temple_desecrated
			years = 30
		}
	}
}

# Sabotage discovered, but your involvement wasn't discovered
character_event = {
	id = japan.126
	desc = EVTDESC_JAPAN_126
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_126 # Try to act surprised
		detract_society_currency_tiny_effect = yes
		
		piety = -5
	}
}

# Sabotage discovered - increase suspicion
character_event = {
	id = japan.127
	desc = EVTDESC_JAPAN_127
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_127 # Oh no!
		detract_society_currency_minor_effect = yes
		increase_visibility_effect = yes
		
		piety = -25
	}
}

# Vassal attempts sabotage - check outcome
character_event = {
	id = japan.128
	hide_window = yes
	is_triggered_only = yes

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
		society_member_of = the_ghost_gatherers
	}
	
	immediate = {
		random_list = {
			33 = {
				modifier = {
					factor = 2
					intrigue = 28
				}
				modifier = {
					factor = 2
					intrigue = 24
				}
				modifier = {
					factor = 2
					intrigue = 20
				}
				character_event = { id = japan.129 } # Sabotage went well
			}
			34 = {
				character_event = { id = japan.130 } # Sabotage discovered, but not who did it
				FROM = {
					character_event = { id = japan.131 } # Sabotage discovered
				}
			}
			33 = {
				modifier = {
					factor = 2
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 4
					}
				}
				character_event = { id = japan.132 } # Sabotage discovered, suspicion increased
				FROM = {
					character_event = { id = japan.131 } # Sabotage discovered
				}
			}
		}
	}
}

# Sabotage went well - inform vassal
character_event = {
	id = japan.129
	desc = EVTDESC_JAPAN_129
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_129 # Just as planned!
		add_society_currency_minor_effect = yes
		religion_authority = {
			modifier = temple_desecrated
			years = 30
		}
	}
}

# Sabotage discovered, but not your involvement - inform vassal
character_event = {
	id = japan.130
	desc = EVTDESC_JAPAN_130
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_130 # Try to act surprised
		detract_society_currency_tiny_effect = yes
	}
}

# Sabotage discovered - inform liege (both versions)
character_event = {
	id = japan.131
	desc = EVTDESC_JAPAN_131
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_131 # Who could have done this?
		
		piety = -5
	}
}

# Sabotage discovered, increase suspicion - inform vassal
character_event = {
	id = japan.132
	desc = EVTDESC_JAPAN_132
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_132 # Oh no!
		detract_society_currency_minor_effect = yes
		increase_visibility_effect = yes
		
		piety = -25
	}
}

### Garden improvements (133-136)

# Vassal impressed
character_event = {
	id = japan.133
	desc = EVTDESC_JAPAN_133
	picture = GFX_evt_garden

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_133 # I like it!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = japan.134 } # Inform liege
		}
	}
}

# Garden impresses vassal
character_event = {
	id = japan.134
	desc = EVTDESC_JAPAN_134
	picture = GFX_evt_garden

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_134 # Good to hear!
		
		prestige = 25
	}
}

# Weeds in garden upset vassal
character_event = {
	id = japan.135
	desc = EVTDESC_JAPAN_135
	picture = GFX_evt_garden

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_135 # I don't like it!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = japan.136 } # Inform liege
		}
	}
}

# Vassal upset
character_event = {
	id = japan.136
	desc = EVTDESC_JAPAN_136
	picture = GFX_evt_garden

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_136 # Unfortunate
		
		prestige = -25
	}
}

### Entertainment 1 (137-175)

# Lack of entertainment upsets vassal
character_event = {
	id = japan.137
	desc = EVTDESC_JAPAN_137
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_137 # This is boring!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = japan.138 } # Inform liege
		}
	}
}

# Vassal upset
character_event = {
	id = japan.138
	desc = EVTDESC_JAPAN_138
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_138 # Unfortunate
		
		prestige = -25
	}
}

# Shirabyoshi don't show up - liege
character_event = {
	id = japan.139
	desc = EVTDESC_JAPAN_139
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_139 # I want my money back!
		
		prestige = -50
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			opinion = {
				who = FROM
				modifier = bad_hanami
				months = 12
			}
			if = {
				limit = {
					ai = no
				}
				character_event = { id = japan.140 } # Inform vassals
			}
		}
	}
}

# Shirabyoshi don't show up - vassal
character_event = {
	id = japan.140
	desc = EVTDESC_JAPAN_140
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_140 # Surely FROM is just lying!
	}
}

# Shirabyoshi perform poorly - liege
character_event = {
	id = japan.141
	desc = EVTDESC_JAPAN_141
	picture = GFX_evt_scandal

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_141 # Not what I paid for!
		
		prestige = -25
		
		any_vassal = {
			limit = {
				ai = no # The AI shouldn't get events that have no effect...
				has_character_flag = coming_to_hanami
			}
			character_event = { id = japan.142 } # Inform vassals
		}
	}
}

# Shirabyoshi perform poorly - vassal
character_event = {
	id = japan.142
	desc = EVTDESC_JAPAN_142
	picture = GFX_evt_scandal

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_142 # Please make them stop!
	}
}

# Kinswoman is inspired
character_event = {
	id = japan.143
	desc = EVTDESC_JAPAN_143
	picture = GFX_evt_melee # Best option

	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	immediate = {
		set_character_flag = inspired_by_shirabyoshi
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_143 # Teach me how to use a sword!
		change_martial = 1
		
		FROM = {
			character_event = { id = japan.144 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_143 # Teach me how to conduct business!
		change_stewardship = 1
		
		FROM = {
			character_event = { id = japan.144 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_143 # Teach me how to write poetry!
		change_learning = 1
		
		FROM = {
			character_event = { id = japan.144 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTD_JAPAN_143 # Teach me how to convince people!
		random_list = {
			50 = {
				change_diplomacy = 1
			}
			50 = {
				change_intrigue = 1
			}
		}
		
		FROM = {
			character_event = { id = japan.144 } # Inform FROM
		}
	}
}

# Liege is informed
character_event = {
	id = japan.144
	desc = EVTDESC_JAPAN_144
	picture = GFX_evt_emissary

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_144 # Sounds good!
		
		prestige = 10
	}
}

# Shirabyoshi suggests duel - vassal/courtier
character_event = {
	id = japan.145
	desc = EVTDESC_JAPAN_145
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:troublesome_shirabyoshi = {
				is_alive = yes
			}
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_145 # Sure, why not?
		
		FROM = {
			character_event = { id = japan.146 }
		}
		
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_145 # I'd rather not...
		
		prestige = -25
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.1
				trait = brave
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
}

# Liege informed of pending duel
character_event = {
	id = japan.146
	desc = EVTDESC_JAPAN_146
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_146 # Sure, why not?
		
		FROM = {
			character_event = { id = japan.150 } # Vassal/courtier selects stance - shirabyoshi stance triggered from here
		}
		any_vassal = {
			limit = {
				ai = no # No need to spam AI characters with information that doesn't matter to them...
				has_character_flag = coming_to_hanami
				NOT = {
					character = FROM
				}
			}
			character_event = { id = japan.152 }
		}
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_146 # No; get out!
		
		FROM = {
			character_event = { id = japan.147 }
		}
		event_target:troublesome_shirabyoshi = {
			#character_event = { id = japan.148 }
			leave_court_and_die_effect = yes
		}
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = coming_to_hanami
				NOT = {
					character = FROM
				}
			}
			character_event = { id = japan.149 }
		}
		
		ai_chance = {
			factor = 25
		}
	}
}

# FROM informed the duel is off
character_event = {
	id = japan.147
	desc = EVTDESC_JAPAN_147
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_147 # I could have taken her!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
	}
}

# Shirabyoshi informed the duel is off - obsolete
#character_event = {
#	id = japan.148
#	desc = EVTDESC_JAPAN_148
#	picture = GFX_evt_feast
#
#	only_rulers = yes
#	capable_only = yes
#	prisoner = no
#
#	is_triggered_only = yes
#	
#	option = {
#		name = EVTOPTA_JAPAN_148 # I could have taken them!
#	}
#}

# Other vassals informed the duel is off
character_event = {
	id = japan.149
	desc = EVTDESC_JAPAN_149
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_149 # It could have been fun!
	}
}

# Vassal/courtier selects stance
character_event = {
	id = japan.150
	desc = EVTDESC_JAPAN_150
	picture = GFX_evt_melee # Best option

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				trait = cruel
				trait = wroth
				trait = deceitful
				trait = arbitrary
				trait = proud
			}
		}
		name = EVTOPTA_JAPAN_150 # Hold back
		
		set_character_flag = hanami_shirabyoshi_duel_hold_back
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				character_event = { id = japan.151 } # Shirabyoshi picks stance; somewhat influenced by other party's stance
			}
		}
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_150 # Fight fairly
		
		set_character_flag = hanami_shirabyoshi_duel_fair_fight
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				character_event = { id = japan.151 } # Shirabyoshi picks stance; somewhat influenced by other party's stance
			}
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				OR = {
					trait = cruel
					trait = deceitful
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = cruel
				trait = wroth
			}
		}
		name = EVTOPTC_JAPAN_150 # Fight to kill
		
		set_character_flag = hanami_shirabyoshi_duel_fight_to_kill
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				character_event = { id = japan.151 } # Shirabyoshi picks stance; somewhat influenced by other party's stance
			}
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				OR = {
					trait = kind
					trait = just
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = deceitful
				trait = arbitrary
			}
			NOR = {
				trait = humble
				trait = kind
			}
		}
		name = EVTOPTD_JAPAN_150 # Fight dirty
		
		set_character_flag = hanami_shirabyoshi_duel_fight_dirty
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				character_event = { id = japan.151 } # Shirabyoshi picks stance; somewhat influenced by other party's stance
			}
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				OR = {
					trait = kind
					trait = just
				}
			}
		}
	}
}

# Shirabyoshi selects stance
character_event = {
	id = japan.151
	desc = EVTDESC_JAPAN_151
	picture = GFX_evt_melee # Best option

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	immediate = {
		opinion = {
			who = FROM
			modifier = hanami_duel
			months = 1
		}
		reverse_opinion = {
			who = FROM
			modifier = hanami_duel
			months = 1
		}
	}
	
	option = {
		trigger = {
			NOR = {
				trait = cruel
				trait = wroth
				trait = deceitful
				trait = arbitrary
				trait = proud
			}
		}
		name = EVTOPTA_JAPAN_150 # Hold back
		
		set_character_flag = hanami_shirabyoshi_duel_hold_back
		
		FROMFROM = {
			character_event = { id = japan.153 days = 1 } # Ping liege
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fair_fight
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				}
			}
			modifier = {
				factor = 0.25
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_dirty
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_150 # Fight fairly
		
		set_character_flag = hanami_shirabyoshi_duel_fair_fight
		
		FROM = {
			character_event = { id = japan.153 days = 1 } # Ping liege
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				OR = {
					trait = cruel
					trait = deceitful
				}
			}
			modifier = {
				factor = 2
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_hold_back
				}
			}
			modifier = {
				factor = 5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fair_fight
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_dirty
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = cruel
				trait = wroth
			}
		}
		name = EVTOPTC_JAPAN_150 # Fight to kill
		
		set_character_flag = hanami_shirabyoshi_duel_fight_to_kill
		
		FROM = {
			character_event = { id = japan.153 days = 1 } # Ping liege
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				OR = {
					trait = kind
					trait = just
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_hold_back
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fair_fight
				}
			}
			modifier = {
				factor = 10
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				}
			}
			modifier = {
				factor = 2
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_dirty
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = deceitful
				trait = arbitrary
			}
			NOR = {
				trait = humble
				trait = kind
			}
		}
		name = EVTOPTD_JAPAN_150 # Fight dirty
		
		set_character_flag = hanami_shirabyoshi_duel_fight_dirty
		
		FROM = {
			character_event = { id = japan.153 days = 1 } # Ping liege
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				OR = {
					trait = kind
					trait = just
				}
			}
			modifier = {
				factor = 5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_hold_back
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fair_fight
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				}
			}
			modifier = {
				factor = 5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_dirty
				}
			}
		}
	}
}

# Inform non-AI vassals
character_event = {
	id = japan.152
	desc = EVTDESC_JAPAN_152
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_152 # This should be fun
	}
}

# Hidden event for vassal/courtier to calculate the outcome
character_event = {
	id = japan.153
	is_triggered_only = yes
	hide_window = yes
	
	capable_only = yes
	prisoner = no
	
	immediate = {
		random_list = {
			50 = {
				modifier = {
					factor = 2
					combat_rating_diff = {
						who = FROM
						value = 10
					}
				}
				modifier = {
					factor = 2
					combat_rating_diff = {
						who = FROM
						value = 20
					}
				}
				modifier = {
					factor = 2
					combat_rating_diff = {
						who = FROM
						value = 30
					}
				}
				modifier = {
					factor = 2
					combat_rating_diff = {
						who = FROM
						value = 40
					}
				}
				modifier = {
					factor = 0.1
					has_character_flag = hanami_shirabyoshi_duel_hold_back
					FROM = {
						NOT = {
							has_character_flag = hanami_shirabyoshi_duel_hold_back
						}
					}
				}
				modifier = {
					factor = 0.1
					has_character_flag = hanami_shirabyoshi_duel_hold_back
					FROM = {
						has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
					}
				}
				modifier = {
					factor = 2
					has_character_flag = hanami_shirabyoshi_duel_fight_dirty
					FROM = {
						has_character_flag = hanami_shirabyoshi_duel_hold_back
					}
				}
				modifier = {
					factor = 10
					has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
					FROM = {
						has_character_flag = hanami_shirabyoshi_duel_hold_back
					}
				}
				character_event = { id = japan.154 } # Victory!
			}
			50 = {
				modifier = {
					factor = 2
					has_character_flag = hanami_shirabyoshi_duel_hold_back
					FROM = {
						has_character_flag = hanami_shirabyoshi_duel_hold_back
					}
				}
				modifier = {
					factor = 2
					has_character_flag = hanami_shirabyoshi_duel_fight_fairly
					FROM = {
						has_character_flag = hanami_shirabyoshi_duel_fight_fairly
					}
				}
				character_event = { id = japan.159 } # Draw!
			}
			50 = {
				modifier = {
					factor = 2
					FROM = {
						combat_rating_diff = {
							who = ROOT
							value = 10
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						combat_rating_diff = {
							who = ROOT
							value = 20
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						combat_rating_diff = {
							who = ROOT
							value = 30
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						combat_rating_diff = {
							who = ROOT
							value = 40
						}
					}
				}
				modifier = {
					factor = 0.1
					FROM = {
						has_character_flag = hanami_shirabyoshi_duel_hold_back
					}
					NOT = {
						has_character_flag = hanami_shirabyoshi_duel_hold_back
					}
				}
				modifier = {
					factor = 2
					FROM = {
						has_character_flag = hanami_shirabyoshi_duel_fight_dirty
					}
					has_character_flag = hanami_shirabyoshi_duel_hold_back
				}
				FROM = {
					character_event = { id = japan.164 } # Defeat!
				}
			}
		}
	}
}

# Victory - what do you do?
character_event = {
	id = japan.154
	desc = EVTDESC_JAPAN_154
	picture = GFX_evt_melee # Best option
	is_triggered_only = yes
	
	capable_only = yes
	prisoner = no
	
	option = {
		name = EVTOPTA_JAPAN_154 # Be a graceful winner
		
		set_character_flag = won_shirabyoshi_duel
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_good_sport
				months = 12
			}
		}
		
		FROMFROMFROMFROM = {
			character_event = { id = japan.155 } # Inform liege of mercy
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				trait = kind
			}
			modifier = {
				factor = 5
				trait = humble
			}
			modifier = {
				factor = 0.2
				trait = proud
			}
			modifier = {
				factor = 0.2
				trait = cruel
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_154 # Make fun of her!
		
		set_character_flag = won_shirabyoshi_duel
		
		FROMFROMFROMFROM = {
			character_event = { id = japan.155 } # Inform liege of mercy
		}
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = ROOT
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = ROOT
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_bad_sport
				months = 12
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				trait = kind
			}
			modifier = {
				factor = 5
				trait = humble
			}
			modifier = {
				factor = 0.2
				trait = proud
			}
			modifier = {
				factor = 0.2
				trait = cruel
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				trait = wroth
				trait = cruel
			}
		}
		
		name = EVTOPTC_JAPAN_154 # Show no mercy!
		
		prestige = -10
		
		FROMFROMFROMFROM = {
			character_event = { id = japan.157 } # Inform liege of no mercy
		}
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_super_huge_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = ROOT
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_massive_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = ROOT
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_major_effect = yes
			}
		}
		
		FROMFROM = {
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Liege informed of mercy
character_event = {
	id = japan.155
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_good_sport
				}
			}
		}
		text = EVTDESCA_JAPAN_155
	}
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_bad_sport
				}
			}
		}
		text = EVTDESCB_JAPAN_155
	}
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_155 # Unsurprising
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			character_event = { id = japan.156 } # Other vassals are informed
		}
	}
}

# Other vassals informed
character_event = {
	id = japan.156
	desc = {
		trigger = {
			FROMFROMFROMFROM = {
				has_opinion_modifier = {
					who = FROMFROM
					modifier = hanami_duel_good_sport
				}
			}
		}
		text = EVTDESCA_JAPAN_156
	}
	desc = {
		trigger = {
			FROMFROMFROMFROM = {
				has_opinion_modifier = {
					who = FROMFROM
					modifier = hanami_duel_bad_sport
				}
			}
		}
		text = EVTDESCB_JAPAN_156
	}
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_156 # Unsurprising
	}
}

# Vassal merciless - liege
character_event = {
	id = japan.157
	desc = EVTDESC_JAPAN_157
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_157 # That was unnecessary
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			character_event = { id = japan.158 } # Other vassals are informed
		}
	}
}

# Other vassals informed
character_event = {
	id = japan.158
	desc = EVTDESC_JAPAN_158
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_158 # That happened...
	}
}

# Draw - vassal picks how to treat the situation
character_event = {
	id = japan.159
	desc = EVTDESC_JAPAN_159
	picture = GFX_evt_melee # Best option
	
	is_triggered_only = yes
	
	capable_only = yes
	prisoner = no
	
	option = {
		name = EVTOPTA_JAPAN_159 # Well fought!
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_good_sport
				months = 12
			}
		}
		
		FROMFROMFROMFROM = {
			character_event = { id = japan.160 } # Inform liege
		}
		
		prestige = -10
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				trait = kind
			}
			modifier = {
				factor = 5
				trait = humble
			}
			modifier = {
				factor = 0.2
				trait = proud
			}
			modifier = {
				factor = 0.2
				trait = cruel
			}
			modifier = {
				factor = 5
				has_character_flag = hanami_shirabyoshi_duel_fair_fight
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				has_character_flag = hanami_shirabyoshi_duel_hold_back
				trait = wroth
				trait = cruel
				trait = proud
			}
		}
		
		name = EVTOPTB_JAPAN_159 # I held back!
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = ROOT
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = ROOT
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_bad_sport
				months = 12
			}
		}
		
		prestige = 10 # This is bait!
		
		FROMFROMFROMFROM = {
			character_event = { id = japan.162 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Liege informed vassal/courtier was courteous
character_event = {
	id = japan.160
	desc = EVTDESC_JAPAN_160
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_160 # Was she that good?
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			character_event = { id = japan.161 } # Other vassals are informed
		}
	}
}

# Other vassals informed
character_event = {
	id = japan.161
	desc = EVTDESC_JAPAN_161
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_161 # Was she that good?
	}
}

# Liege informed vassal/courtier wasn't courteous
character_event = {
	id = japan.162
	desc = EVTDESC_JAPAN_162
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_162 # Sore loser...
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			character_event = { id = japan.163 } # Other vassals are informed
		}
	}
}

# Other vassals informed
character_event = {
	id = japan.163
	desc = EVTDESC_JAPAN_163
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_163 # Sore loser...
	}
}

# Shirabyoshi won - she picks what to do
character_event = {
	id = japan.164
	desc = EVTDESC_JAPAN_164
	picture = GFX_evt_melee # Best option
	
	is_triggered_only = yes
	
	capable_only = yes
	prisoner = no
	
	option = {
		name = EVTOPTA_JAPAN_164 # Spare the vassal/courtier!
		
		FROMFROMFROMFROM = {
			character_event = { id = japan.165 } # Ping liege
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				trait = kind
			}
			modifier = {
				factor = 5
				trait = humble
			}
			modifier = {
				factor = 0.2
				trait = proud
			}
			modifier = {
				factor = 0.2
				trait = cruel
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				trait = wroth
				trait = cruel
			}
		}
		
		name = EVTOPTB_JAPAN_164 # Show no mercy!
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_super_huge_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = ROOT
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_massive_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = ROOT
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_major_effect = yes
			}
		}
		
		prestige = -10
		
		FROM = {
			character_event = { id = japan.171 } # Inform vassal
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Ping liege
character_event = {
	id = japan.165
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			character_event = { id = japan.166 } # Vassal informed
		}
	}
}


# Loss - vassal picks how to treat the situation
character_event = {
	id = japan.166
	desc = EVTDESC_JAPAN_166
	picture = GFX_evt_melee # Best option
	is_triggered_only = yes
	
	capable_only = yes
	prisoner = no
	
	option = {
		name = EVTOPTA_JAPAN_166 # Well fought!
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_good_sport
				months = 12
			}
		}
		
		FROM = {
			character_event = { id = japan.167 } # Inform liege
		
			any_vassal = {
				limit = {
					ai = no # The AI doesn't care
					has_character_flag = going_to_hanami
					NOT = {
						character = ROOT
					}
				}
				character_event = { id = japan.168 } # Other vassals are informed
			}
		}
		
		prestige = -25
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				trait = kind
			}
			modifier = {
				factor = 5
				trait = humble
			}
			modifier = {
				factor = 0.2
				trait = proud
			}
			modifier = {
				factor = 0.2
				trait = cruel
			}
			modifier = {
				factor = 5
				has_character_flag = hanami_shirabyoshi_duel_fair_fight
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				has_character_flag = hanami_shirabyoshi_duel_hold_back
				trait = wroth
				trait = cruel
				trait = proud
			}
		}
		
		name = EVTOPTB_JAPAN_166 # I held back!
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = ROOT
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = ROOT
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_bad_sport
				months = 12
			}
		}
		
		prestige = -10 # This is bait!
		
		FROM = {
			character_event = { id = japan.169 } # Inform liege
		
			any_vassal = {
				limit = {
					ai = no # The AI doesn't care
					has_character_flag = going_to_hanami
					NOT = {
						character = ROOT
					}
				}
				character_event = { id = japan.170 } # Other vassals are informed
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Liege informed vassal/courtier was courteous
character_event = {
	id = japan.167
	desc = EVTDESC_JAPAN_167
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_167 # Was she that good?
	}
}

# Other vassals informed
character_event = {
	id = japan.168
	desc = EVTDESC_JAPAN_168
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_168 # Was she that good?
	}
}

# Liege informed vassal/courtier wasn't courteous
character_event = {
	id = japan.169
	desc = EVTDESC_JAPAN_169
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_169 # Sore loser...
	}
}

# Other vassals informed
character_event = {
	id = japan.170
	desc = EVTDESC_JAPAN_170
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_170 # Sore loser...
	}
}

# Killed by shirabyoshi
character_event = {
	id = japan.171
	desc = EVTDESC_JAPAN_171
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_171 # NOOOOO!
		
		liege = {
			character_event = { id = japan.172 }
		}
		
		death = {
			death_reason = death_duel
			killer = FROM
		}
	}
}

# Shirabyoshi merciless - liege
character_event = {
	id = japan.172
	desc = EVTDESC_JAPAN_172
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_172 # That was unnecessary
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			character_event = { id = japan.173 } # Other vassals are informed
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				FROM = {
					dynasty = ROOT
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_172 # Imprison the shirabyoshi
		
		event_target:troublesome_shirabyoshi = {
			imprison = yes
		}
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			character_event = { id = japan.173 } # Other vassals are informed
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = {
					FROM = {
						dynasty = ROOT
					}
				}
			}
		}
	}
}

# Other vassals informed
character_event = {
	id = japan.173
	desc = EVTDESC_JAPAN_173
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_173 # That happened...
	}
}

# Remarkable shirabyoshi
character_event = {
	id = japan.174
	desc = EVTDESC_JAPAN_174
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_174 # She's welcome to stay!
		
		prestige = 50
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			opinion = {
				who = ROOT
				modifier = good_hanami
				months = 12
			}
			if = {
				limit = {
					ai = no
				}
				character_event = { id = japan.175 } # Inform vassals
			}
		}
	}
}

# Remarkable shirabyoshi - vassal
character_event = {
	id = japan.175
	desc = EVTDESC_JAPAN_175
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_175 # She's good!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

##### Event group 2 (176-226)

### Daytime events (176-188)

# Beautiful weather
character_event = {
	id = japan.176
	desc = EVTDESC_JAPAN_176
	picture = GFX_evt_garden

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}

	option = {
		name = EVTOPTA_JAPAN_176 # I sure picked a good day!
		
		prestige = 10
	}
}

# Become friends?
character_event = {
	id = japan.177
	desc = EVTDESC_JAPAN_177
	picture = GFX_evt_courtiers_talking

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_friend_2 = {
				is_alive = yes
				is_inaccessible_or_incapable_trigger = no
				prisoner = no
			}
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_177 # I should speak more with X
		FROM = {
			event_target:hanami_friend_2 = {
				character_event = { id = japan.178 days = 1 }
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_177 # I don't need another friend
		
		ai_chance = {
			factor = 0
		}
	}
}

# Become friends?
character_event = {
	id = japan.178
	desc = EVTDESC_JAPAN_178
	picture = GFX_evt_courtiers_talking

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_178 # I should speak more with X
		add_friend = FROM
		FROM = {
			character_event = { id = japan.179 }
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_178 # I don't need another friend
		
		prestige = -5
		
		FROM = {
			character_event = { id = japan.179 }
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Inform FROM
character_event = {
	id = japan.179
	desc = {
		trigger = {
			any_friend = {
				character = FROM
			}
		}
		text = EVTDESCA_JAPAN_179
	}
	desc = {
		trigger = {
			NOT = {
				any_friend = {
					character = FROM
				}
			}
		}
		text = EVTDESCB_JAPAN_179
	}
	picture = GFX_evt_courtiers_talking

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			any_friend = {
				character = FROM
			}
		}
		name = EVTOPTA_JAPAN_179 # Good!
		
		add_friend = FROM
	}
	
	option = {
		trigger = {
			NOT = {
				any_friend = {
					character = FROM
				}
			}
		}
		name = EVTOPTB_JAPAN_179 # Rude!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
	}
}

# Become rivals?
character_event = {
	id = japan.180
	desc = EVTDESC_JAPAN_180
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_rival_2 = {
				is_alive = yes
				is_inaccessible_or_incapable_trigger = no
				prisoner = no
			}
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_180 # They'd better apologize!
		FROM = {
			event_target:hanami_rival_2 = {
				character_event = { id = japan.181 days = 1 }
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_180 # Let's not make matters worse
		
		prestige = -5
		
		ai_chance = {
			factor = 0
		}
	}
}

# Become rivals?
character_event = {
	id = japan.181
	desc = EVTDESC_JAPAN_181
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_181 # I hate you too!
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = ROOT
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = ROOT
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
		add_rival = FROM
		FROM = {
			character_event = { id = japan.182 }
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_181 # Let's make amends
		
		prestige = -5
		
		FROM = {
			character_event = { id = japan.182 }
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Inform FROM
character_event = {
	id = japan.182
	desc = {
		trigger = {
			any_rival = {
				character = FROM
			}
		}
		text = EVTDESCA_JAPAN_182
	}
	desc = {
		trigger = {
			NOT = {
				any_rival = {
					character = FROM
				}
			}
		}
		text = EVTDESCB_JAPAN_182
	}
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			any_rival = {
				character = FROM
			}
		}
		name = EVTOPTA_JAPAN_182 # You're going down!
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = ROOT
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = ROOT
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
		
		add_rival = FROM
	}
	
	option = {
		trigger = {
			NOT = {
				any_rival = {
					character = FROM
				}
			}
		}
		name = EVTOPTB_JAPAN_182 # Very well!
		
		opinion = {
			who = FROM
			modifier = opinion_glad
			months = 12
		}
	}
}

# Arguing vassals - liege
character_event = {
	id = japan.183
	desc = EVTDESC_JAPAN_183
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_183 # Try to make things better
		hidden_tooltip = {
			if = {
				limit = {
					diplomacy = 12
				}
				character_event = { id = japan.184 days = 1 } # Good outcome
			}
			if = {
				limit = {
					NOT = {
						diplomacy = 12
					}
					diplomacy = 4
				}
				random_list = {
					50 = {
						character_event = { id = japan.184 days = 1 } # Good outcome
					}
					50 = {
						character_event = { id = japan.186 days = 1 } # Bad outcome
					}
				}
			}
			if = {
				limit = {
					NOT = {
						diplomacy = 4
					}
				}
				character_event = { id = japan.186 days = 1 } # Bad outcome
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				OR = {
					trait = craven
					trait = shy
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_183 # Let's not get involved...
		
		prestige = -10
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				OR = {
					trait = socializer
					trait = gregarious
				}
				NOR = {
					trait = craven
					trait = shy
				}
			}
		}
	}
}

# Liege made things better
character_event = {
	id = japan.184
	desc = EVTDESC_JAPAN_184
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_184 # Good!
		
		prestige = 10		
		
		event_target:arguing_hanami_vassal_1 = {
			character_event = { id = japan.185 }
		}
		event_target:arguing_hanami_vassal_2 = {
			character_event = { id = japan.185 }
		}
	}
}

# Inform vassals
character_event = {
	id = japan.185
	desc = EVTDESC_JAPAN_185
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_185 # Good!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

# Liege made things worse
character_event = {
	id = japan.186
	desc = EVTDESC_JAPAN_186
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_186 # Not good!
		
		prestige = -10		
		
		event_target:arguing_hanami_vassal_1 = {
			character_event = { id = japan.187 }
		}
		event_target:arguing_hanami_vassal_2 = {
			character_event = { id = japan.187 }
		}
	}
}

# Inform vassals
character_event = {
	id = japan.187
	desc = EVTDESC_JAPAN_187
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_187 # Rude!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		if = {
			limit = {
				FROM = {
					event_target:arguing_hanami_vassal_1 = {
						character = ROOT
					}
				}
			}
			FROM = {
				event_target:arguing_hanami_vassal_2 = {
					opinion = {
						who = ROOT
						modifier = opinion_upset
						months = 12
					}
					reverse_opinion = {
						who = ROOT
						modifier = opinion_upset
						months = 12
					}
				}
			}
			break = yes
		}
		if = {
			limit = {
				FROM = {
					event_target:arguing_hanami_vassal_2 = {
						character = ROOT
					}
				}
			}
			FROM = {
				event_target:arguing_hanami_vassal_1 = {
					opinion = {
						who = ROOT
						modifier = opinion_upset
						months = 12
					}
					reverse_opinion = {
						who = ROOT
						modifier = opinion_upset
						months = 12
					}
				}
			}
			break = yes
		}
	}
}

# Visiting priest(ess)
character_event = {
	id = japan.188
	desc = EVTDESC_JAPAN_188
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_188 # Great!
		
		piety = 10
	}
}

### Nighttime events (189-208)

# Attempt to tumble other character?
character_event = {
	id = japan.189
	desc = EVTDESC_JAPAN_189
	picture = GFX_evt_brothel

	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_lover_2 = {
				is_alive = yes
			}
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_189 # Yes!
		
		piety = -5
		
		FROM = {
			event_target:hanami_lover_2 = {
				character_event = { id = japan.190 days = 1 } # Other vassal chooses how to respond
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				NOR = {
					trait = lustful
					trait = seducer
					trait = seductress
				}
			}
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_189 # No!
		
		piety = 5
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				trait = lustful
			}
			modifier = {
				factor = 0.5
				trait = seducer
			}
			modifier = {
				factor =  0.5
				trait = seductress
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 2
				trait = zealous
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 5
				trait = paranoid
			}
		}
	}
}

# Tumble?
character_event = {
	id = japan.190
	desc = EVTDESC_JAPAN_190
	picture = GFX_evt_brothel

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_lover_1 = {
				is_alive = yes
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_190 # Yes!
		
		#STDs and pregnancy
		FROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
		
		add_lover = FROM
		
		FROM = {
			character_event = { id = japan.192 }
		}
		
		piety = -5
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				NOR = {
					trait = lustful
					trait = seducer
					trait = seductress
				}
			}
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
			}
			modifier = {
				factor = 0
				has_character_modifier = dismissed_proposal # Refusing all seduction attempts!
			}
			modifier = {
				factor = 5
				FROM = {
					OR = {
						trait = seducer
						trait = seductress
					}
				}
			}
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_190 # No!
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				FROM = {
					is_chinese_emperor_trigger = no
				}
			}
			detract_grace_major_effect = yes
		}
		
		piety = 5
		
		FROM = {
			character_event = { id = japan.191 }
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				trait = lustful
			}
			modifier = {
				factor = 0.5
				trait = seducer
			}
			modifier = {
				factor =  0.5
				trait = seductress
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 2
				trait = zealous
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 5
				trait = paranoid
			}
		}
	}
}

# No lover
character_event = {
	id = japan.191
	desc = EVTDESC_JAPAN_191
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_191 # Rude!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
	}
}

# Got lover
character_event = {
	id = japan.192
	desc = EVTDESC_JAPAN_192
	picture = GFX_evt_lovers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_192 # Great!
		
		add_lover = FROM
		
		hidden_tooltip = {
			if = {
				limit = {
					OR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value = 4
							}
						}
						FROM = {
							FROMFROM = {
								attribute_diff = {
									character = PREV
									attribute = intrigue
									value = 4
								}
							}
						}
					}
					NOR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value = 8
							}
						}
						FROM = {
							FROMFROM = {
								attribute_diff = {
									character = PREV
									attribute = intrigue
									value = 8
								}
							}
						}
					}
				}
				random_list = {
					25 = {
						FROMFROMFROM = {
							character_event = { id = japan.193 } # Liege discovers tumbling
						}
					}
					75 = {}
				}
			}
			if = {
				limit = {
					OR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value = 8
							}
						}
						FROM = {
							FROMFROM = {
								attribute_diff = {
									character = PREV
									attribute = intrigue
									value = 8
								}
							}
						}
					}
					NOR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value = 12
							}
						}
						FROM = {
							FROMFROM = {
								attribute_diff = {
									character = PREV
									attribute = intrigue
									value = 12
								}
							}
						}
					}
				}
				random_list = {
					50 = {
						FROMFROMFROM = {
							character_event = { id = japan.193 } # Liege discovers tumbling
						}
					}
					50 = {}
				}
			}
			if = {
				limit = {
					OR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value = 12
							}
						}
						FROM = {
							FROMFROM = {
								attribute_diff = {
									character = PREV
									attribute = intrigue
									value = 12
								}
							}
						}
					}
					NOR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value = 16
							}
						}
						FROM = {
							FROMFROM = {
								attribute_diff = {
									character = PREV
									attribute = intrigue
									value = 16
								}
							}
						}
					}
				}
				random_list = {
					75 = {
						FROMFROMFROM = {
							character_event = { id = japan.193 } # Liege discovers tumbling
						}
					}
					25 = {}
				}
			}
			if = {
				limit = {
					OR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value = 16
							}
						}
						FROM = {
							FROMFROM = {
								attribute_diff = {
									character = PREV
									attribute = intrigue
									value = 16
								}
							}
						}
					}
				}
				FROMFROMFROM = {
					character_event = { id = japan.193 } # Liege discovers tumbling
				}
			}
		}
	}
}

# Tumbling discovered - liege chooses how to react
character_event = {
	id = japan.193
	desc = EVTDESC_JAPAN_193
	picture = GFX_evt_lovers

	capable_only = yes
	prisoner = no
	only_rulers = yes
	war = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}

	is_triggered_only = yes
	
	# No need to have Grace penalties applied to the lovers here since the AI will trigger normal adultery fallout if closely related to the characters in question and that handles it already
	
	option = {
		name = EVTOPTA_JAPAN_193 # Keep it secret!
		
		FROM = {
			character_event = { id = japan.194 days = 1 }
		}
		FROMFROM = {
			character_event = { id = japan.195 days = 1 }
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 0
				OR = {
					FROM = {
						OR = {
							any_spouse = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							any_consort = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							AND = {
								dynasty = ROOT
								any_close_relative = {
									character = ROOT
								}
							}
						}
					}
					FROMFROM = {
						OR = {
							any_spouse = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							any_consort = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							AND = {
								dynasty = ROOT
								any_close_relative = {
									character = ROOT
								}
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_193 # Try to blackmail them!
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
		
		FROM = {
			character_event = { id = japan.196 days = 1 }
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				trait = ambitious
			}
			modifier = {
				factor = 5
				trait = deceitful
			}
			modifier = {
				factor = 0
				OR = {
					FROM = {
						OR = {
							any_spouse = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							any_consort = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							AND = {
								dynasty = ROOT
								any_close_relative = {
									character = ROOT
								}
							}
						}
					}
					FROMFROM = {
						OR = {
							any_spouse = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							any_consort = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							AND = {
								dynasty = ROOT
								any_close_relative = {
									character = ROOT
								}
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_193 # Expose them!
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
					FROMFROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
		
		FROM = {
			character_event = { id = japan.201 days = 1 } # Inform of outing
		}
		FROMFROM = {
			character_event = { id = japan.201 days = 1 } # Inform of outing
		}
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
				NOR = {
					character = FROM
					character = FROMFROM
				}
			}
			character_event = { id = japan.202 days = 1 } # Inform of outing
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 5
				trait = cruel
			}
		}
	}
}

# Liege keeps secret - lover 1
character_event = {
	id = japan.194
	desc = EVTDESC_JAPAN_194
	picture = GFX_evt_whispers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_194 # Phew!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

# Liege keeps secret - lover 2
character_event = {
	id = japan.195
	desc = EVTDESC_JAPAN_195
	picture = GFX_evt_whispers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_195 # Phew!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

# Blackmail attempt - lover 1
character_event = {
	id = japan.196
	desc = EVTDESC_JAPAN_196
	picture = GFX_evt_whispers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			wealth = 25
		}
		name = EVTOPTA_JAPAN_196 # Fine! I'll pay!
		
		FROMFROMFROM = {
			character_event = { id = japan.198 } # Other lover needs to accept too
		}
		
		custom_tooltip = {
			text = EVTTOOLTIPA_JAPAN_196
			wealth = -25
			FROM = {
				wealth = 25
			}
		}
		
		opinion = {
			who = FROM
			modifier = hanami_lover_paid_money
			months = 1
		}
		
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Conclave"
			FROM = {
				OR = {
					any_voter = {
						character = ROOT
					}
					any_vassal = {
						character = ROOT
					}
				}
				NOT = {
					holds_favor_on = ROOT
				}
			}
		}
		name = EVTOPTB_JAPAN_196 # Fine! I owe you one!
		
		FROMFROMFROM = {
			character_event = { id = japan.198 } # Other lover needs to accept too
		}
		
		custom_tooltip = {
			text = EVTTOOLTIPB_JAPAN_196
			reverse_add_favor = FROM
		}
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_196 # Never!
		
		FROM = {
			character_event = { id = japan.200 }
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}
}

# Blackmail accepted - OBSOLETE
#character_event = {
#	id = japan.197
#	desc = EVTDESC_JAPAN_197
#	picture = GFX_evt_feast
#
#	capable_only = yes
#	prisoner = no
#
#	is_triggered_only = yes
#	
#	option = {
#		name = EVTOPTA_JAPAN_197 # Ok!
#	}
#}

# Blackmail attempt 2
character_event = {
	id = japan.198
	desc = EVTDESC_JAPAN_198
	picture = GFX_evt_whispers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			wealth = 25
		}
		name = EVTOPTA_JAPAN_196 # Fine! I'll pay!
		
		FROMFROM = {
			character_event = { id = japan.199 } # Inform liege
		}
		
		wealth = -25
		FROM = {
			wealth = 25
		}
		
		opinion = {
			who = FROM
			modifier = hanami_lover_paid_money
			months = 1
		}
		
		hidden_tooltip = {
			if = {
				limit = {
					FROMFROM = {
						reverse_has_opinion_modifier = {
							who = event_target:hanami_lover_1
							modifier = hanami_lover_paid_money
						}
					}
					FROMFROM = {
						wealth = 25
					}
					FROM = {
						wealth = -25
					}
				}
				break = yes
			}
			event_target:hanami_lover_1 = {
				reverse_add_favor = FROMFROM
			}
		}
		
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Conclave"
			FROMFROM = {
				OR = {
					any_voter = {
						character = ROOT
					}
					any_vassal = {
						character = ROOT
					}
				}
				NOT = {
					holds_favor_on = ROOT
				}
			}
		}
		name = EVTOPTB_JAPAN_196 # Fine! I owe you one!
		
		FROMFROM = {
			character_event = { id = japan.199 } # Inform liege
		}
		
		reverse_add_favor = FROMFROM
		
		hidden_tooltip = {
			if = {
				limit = {
					FROMFROM = {
						reverse_has_opinion_modifier = {
							who = event_target:hanami_lover_1
							modifier = hanami_lover_paid_money
						}
					}
					FROMFROM = {
						wealth = 25
					}
					FROM = {
						wealth = -25
					}
				}
				break = yes
			}
			event_target:hanami_lover_1 = {
				reverse_add_favor = FROMFROM
			}
		}
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_196 # Never!
		
		FROM = {
			character_event = { id = japan.200 }
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}
}

# Blackmail accepted
character_event = {
	id = japan.199
	desc = EVTDESC_JAPAN_199
	picture = GFX_evt_whispers

	capable_only = yes
	prisoner = no
	only_rulers = yes
	war = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_199
		
		if = {
			limit = {
				FROMFROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = hanami_lover_paid_money
					}
				}
			}
			FROMFROM = {
				wealth = -25
			}
			wealth = 25
		}
		
		if = {
			limit = {
				NOT = {
					FROMFROM = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hanami_lover_paid_money
						}
					}
				}
			}
			add_favor = FROMFROM
		}
		
		if = {
			limit = {
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = hanami_lover_paid_money
					}
				}
			}
			FROM = {
				wealth = -25
			}
			wealth = 25
		}
		
		if = {
			limit = {
				NOT = {
					FROM = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hanami_lover_paid_money
						}
					}
				}
			}
			
			add_favor = FROM
		}
	}
}
	
# Blackmail not accepted
character_event = {
	id = japan.200
	desc = EVTDESC_JAPAN_200
	picture = GFX_evt_whispers

	capable_only = yes
	prisoner = no
	only_rulers = yes
	war = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_200 # Expose them!
		
		FROM = {
			character_event = { id = japan.201 days = 1 } # Inform of outing
		}
		FROMFROM = {
			character_event = { id = japan.201 days = 1 } # Inform of outing
		}
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
				NOR = {
					character = FROM
					character = FROMFROM
				}
			}
			character_event = { id = japan.202 days = 1 } # Inform of outing
		}
		
	}
}

# Lovers being outed
character_event = {
	id = japan.201
	desc = EVTDESC_JAPAN_201
	picture = GFX_evt_scandal

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_201 # Oh no!
		
		prestige = -100
		piety = -50
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROMFROM = {
			save_event_target_as = target_adulterer
		}
		FROMFROMFROM = {
			character_event = { id = 20 } # Adultery fallout
		}
	}
}

# Other vassals informed
character_event = {
	id = japan.202
	desc = EVTDESC_JAPAN_202
	picture = GFX_evt_scandal

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				any_spouse = {
					character = FROMFROM
				}
				any_consort = {
					character = FROMFROM
				}
				any_spouse = {
					character = FROMFROMFROM
				}
				any_consort = {
					character = FROMFROMFROM
				}
				any_child = {
					character = FROMFROM
				}
				any_child = {
					character = FROMFROMFROM
				}
			}
		}
		name = EVTOPTA_JAPAN_202 # I see...
	}
	
	option = {
		trigger = {
			OR = {
				any_spouse = {
					character = FROMFROM
				}
				any_consort = {
					character = FROMFROM
				}
				any_spouse = {
					character = FROMFROMFROM
				}
				any_consort = {
					character = FROMFROMFROM
				}
			}
		}
		name = EVTOPTB_JAPAN_202 # They will pay!
		
		if = {
			limit = {
				any_lover = {
					character = FROMFROM
				}
			}
			remove_lover = FROMFROM
		}
		if = {
			limit = {
				any_lover = {
					character = FROMFROMFROM
				}
			}
			remove_lover = FROMFROMFROM
		}
		add_rival = FROMFROM
		add_rival = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				any_child = {
					character = FROMFROM
				}
				any_child = {
					character = FROMFROMFROM
				}
			}
		}
		name = EVTOPTC_JAPAN_202 # They will pay!
		
		if = {
			limit = {
				any_child = {
					character = FROMFROM
				}
			}
			add_rival = FROMFROMFROM
		}
		if = {
			limit = {
				any_child = {
					character = FROMFROMFROM
				}
			}
			add_rival = FROMFROM
		}
	}
}

# Townspeople complain about loud party
character_event = {
	id = japan.203
	desc = EVTDESC_JAPAN_203
	picture = GFX_evt_emissary

	capable_only = yes
	prisoner = no
	only_rulers = yes
	war = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_203 # We'll tone it down!
		
		prestige = -25
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 0
				trait = cruel
			}
		}
	}

	option = {
		name = EVTOPTB_JAPAN_203 # Shut up, peasant!
		
		capital_scope = {
			add_province_modifier = {
				name = peasants_upset
				duration = 365
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				trait = kind
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 10
				trait = cruel
			}
		}
	}
}

# Someone sneaking about
character_event = {
	id = japan.204
	desc = EVTDESC_JAPAN_204
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	only_rulers = yes
	war = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = paranoid
			}
		}
		
		name = EVTOPTA_JAPAN_204 # Who goes there?
		
		random = {
			chance = 15
			add_trait = paranoid
		}
	}
	
	option = {
		trigger = {
			trait = paranoid
		}
		
		name = EVTOPTB_JAPAN_204 # Guards, to me!
		
		prestige = -25
	}
}

# Sleeping vassal
character_event = {
	id = japan.205
	desc = EVTDESC_JAPAN_205
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	only_rulers = yes
	war = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
		event_target:sleeping_hanami_vassal = {
			is_alive = yes
			prisoner = no
			is_inaccessible_or_incapable_trigger = no
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_205 # Draw something on their face!
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						intrigue = 4
					}
				}
				event_target:sleeping_hanami_vassal = {
					character_event = { id = japan.207 days = 1 } # Doodling not discovered
				}
			}
			50 = {
				modifier = {
					factor = 0
					intrigue = 16
				}
				event_target:sleeping_hanami_vassal = {
					character_event = { id = japan.208 days = 1 } # Doodling discovered
				}
			}
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				trait = kind
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_204 # Let's not
		
		#event_target:sleeping_hanami_vassal = {
		#	character_event = { id = japan.206 days = 1 } # Doodling discovered
		#}
		
		piety = 5
		
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0
				trait = cruel
			}
		}
	}
}

# Vassal wakes up, nothing happened - obsolete
#character_event = {
#	id = japan.206
#	desc = EVTDESC_JAPAN_206
#	picture = GFX_evt_feast
#
#	capable_only = yes
#	prisoner = no
#	only_rulers = yes
#	
#	is_triggered_only = yes
#	
#	option = {
#		name = EVTOPTA_JAPAN_206 # I needed that!
#	}	
#}

# Vassal wakes up, discovers doodling
character_event = {
	id = japan.207
	desc = EVTDESC_JAPAN_207
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_207 # Who could have done this?
		
		prestige = -10
	}	
}

# Vassal wakes up, discovers doodling attempt and perpetrator
character_event = {
	id = japan.208
	desc = EVTDESC_JAPAN_208
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_208 # Stop that!
		
		FROM = {
			character_event = { id = japan.209 } # Liege informed
		}
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
	}	
}

# Liege discovered
character_event = {
	id = japan.209
	desc = EVTDESC_JAPAN_209
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	only_rulers = yes
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_209 # It was just a prank!
		
		prestige = -10
	}
}

### Misc events (210-222)

# Sake
character_event = {
	id = japan.210
	desc = EVTDESC_JAPAN_210
	picture = GFX_evt_feast

	capable_only = yes
	prisoner = no
	only_rulers = yes
	war = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			trait = temperate
			NOT = {
				trait = drunkard
			}
		}
		name = EVTOPTA_JAPAN_210 # Try to drink in moderation
		
		random = {
			chance = 20
			remove_trait = temperate
		}
	}
	
	option = {
		trigger = {
			NOR = {
				trait = temperate
				trait = drunkard
			}
		}
		name = EVTOPTB_JAPAN_210 # Drink some more
		
		random = {
			chance = 20
			add_trait = drunkard
		}
	}
	
	option = {
		trigger = {
			trait = drunkard
		}
		name = EVTOPTC_JAPAN_210 # Drink a lot
		
		prestige = -25
	}
}

# Hold poetry contest?
character_event = {
	id = japan.211
	desc = EVTDESC_JAPAN_211
	picture = GFX_evt_council

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_211 # Issue a challenge!
		
		FROM = {
			character_event = { id = japan.212 } # Liege is challenged
		}
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_211 # Let's not
		
		prestige = -10
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				trait = poet
			}
		}
	}
}

# Poetry contest?
character_event = {
	id = japan.212
	desc = EVTDESC_JAPAN_212
	picture = GFX_evt_council

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_211 # Challenge accepted!
		
		FROM = {
			character_event = { id = japan.214 } # Inform FROM
		}
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_211 # Let's not
		
		FROM = {
			character_event = { id = japan.213 } # Inform FROM
		}
		
		prestige = -25
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				trait = poet
			}
		}
	}
}

# Liege refused contest
character_event = {
	id = japan.213
	desc = EVTDESC_JAPAN_213
	picture = GFX_evt_council

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_213 # I see...
	}
}

# Calculate outcome
character_event = {
	id = japan.214

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			50 = {
				modifier = {
					factor = 10
					trait = poet
				}
				modifier = {
					factor = 2
					learning = 12
				}
				modifier = {
					factor = 2
					learning = 16
				}
				modifier = {
					factor = 2
					learning = 20
				}
				modifier = {
					factor = 2
					learning = 24
				}
				modifier = {
					factor = 2
					learning = 28
				}
				character_event = { id = japan.215 days = 1 } # Vassal won
				FROM = {
					character_event = { id = japan.216 days = 1 } # Liege lost
				}
			}
			50 = {
				modifier = {
					factor = 10
					FROM = {
						trait = poet
					}
				}
				modifier = {
					factor = 2
					FROM = {
						learning = 12
					}
				}
				modifier = {
					factor = 2
					FROM = {
						learning = 16
					}
				}
				modifier = {
					factor = 2
					FROM = {
						learning = 20
					}
				}
				modifier = {
					factor = 2
					FROM = {
						learning = 24
					}
				}
				modifier = {
					factor = 2
					FROM = {
						learning = 28
					}
				}
				character_event = { id = japan.216 days = 1 } # Vassal lost
				FROM = {
					character_event = { id = japan.215 days = 1 } # Liege won
				}
			}
		}
	}
}

# You won
character_event = {
	id = japan.215
	desc = EVTDESC_JAPAN_215
	picture = GFX_evt_council

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = poet
			}
		}
		name = EVTOPTA_JAPAN_215# I should do this more often
		
		add_trait = poet
	}
	
	option = {
		trigger = {
			NOT = {
				trait = poet
			}
		}
		name = EVTOPTB_JAPAN_215 # This went well
		
		prestige = 10
	}
	
	option = {
		trigger = {
			trait = poet
		}
		name = EVTOPTC_JAPAN_215 # I know how to use words effectively
		
		prestige = 25
	}
}

# You lost
character_event = {
	id = japan.216
	desc = EVTDESC_JAPAN_216
	picture = GFX_evt_council

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_216 # Unfortunate
		
		prestige = -10
	}
}

# Insulted by other vassal - duel them?
character_event = {
	id = japan.217
	desc = EVTDESC_JAPAN_217
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_217 # Issue a challenge!
		
		FROM = {
			event_target:hanami_duel_vassal_2 = {
				character_event = { id = japan.218 } # Other vassal is challenged
			}
		}
		
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0
				OR = {
					trait = craven
					trait = kind
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_211 # Let's not
		
		prestige = -10
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				NOR = {
					trait = craven
					trait = kind
				}
				OR = {
					trait = proud
					trait = cruel
					trait = wroth
				}
			}
		}
	}
}

# Challenge issued - accept?
character_event = {
	id = japan.218
	desc = EVTDESC_JAPAN_218
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_218 # Challenge accepted!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value = 10
						}
					}
					modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value = 20
						}
					}
					modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value = 30
						}
					}
					modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value = 40
						}
					}
					FROMFROM = {
						set_character_flag = hanami_duel_challengee_won
					}
				}
				50 = {
					FROMFROM = {
						set_character_flag = hanami_duel_draw
					}
				}
				50 = {
					modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value = 10
							}
						}
					}
					modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value = 20
							}
						}
					}
					modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value = 30
							}
						}
					}
					modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value = 40
							}
						}
					}
					FROMFROM = {
						set_character_flag = hanami_duel_challenger_won
					}
				}
			}
			character_event = { id = japan.221 days = 1 }
			FROM = {
				character_event = { id = japan.221 days = 1 }
			}
			FROMFROM = {
				character_event = { id = japan.220 days = 1 }
				any_vassal = {
					limit = {
						ai = no # The AI doesn't care
						has_character_flag = coming_to_hanami
						NOR = {
							event_target:hanami_duel_vassal_1 = {
								character = PREV
							}
							event_target:hanami_duel_vassal_2 = {
								character = PREV
							}
						}
					}
					character_event = { id = japan.222 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0
				OR = {
					trait = craven
					trait = kind
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_218 # I apologize
		
		prestige = -25
		
		FROM = {
			character_event = { id = japan.219 days = 1 } # Apology
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 10
				trait = gregarious
			}
			modifier = {
				factor = 10
				trait = socializer
			}
			modifier = {
				factor = 0
				NOR = {
					trait = craven
					trait = kind
				}
				OR = {
					trait = proud
					trait = cruel
					trait = wroth
				}
			}
		}
	}
}

# Apology issued
character_event = {
	id = japan.219
	desc = EVTDESC_JAPAN_219
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_219 # I'll take it!
		
		prestige = 25
	}
}

# Liege informed of duel outcome
character_event = {
	id = japan.220
	desc = {
		trigger = {
			has_character_flag = hanami_duel_challengee_won
		}
		text = EVTDESCA_JAPAN_220
	}
	desc = {
		trigger = {
			has_character_flag = hanami_duel_draw
		}
		text = EVTDESCB_JAPAN_220
	}
	desc = {
		trigger = {
			has_character_flag = hanami_duel_challenger_won
		}
		text = EVTDESCC_JAPAN_220
	}
	
	picture = GFX_evt_emissary
	
	is_triggered_only = yes

	capable_only = yes
	prisoner = no
	only_rulers = yes
	war = no
	
	option = {
		name = EVTOPTA_JAPAN_220 # I see...
	}
}

# Duelling vassals informed of outcome
character_event = {
	id = japan.221
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challengee_won
			}
			character = FROM
		}
		text = EVTDESCA_JAPAN_221
	}
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_draw
			}
			character = FROM
		}
		text = EVTDESCB_JAPAN_221
	}
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challenger_won
			}
			character = FROM
		}
		text = EVTDESCC_JAPAN_221
	}
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challengee_won
			}
			character = FROMFROM
		}
		text = EVTDESCD_JAPAN_221
	}
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_draw
			}
			character = FROMFROM
		}
		text = EVTDESCE_JAPAN_221
	}
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challenger_won
			}
			character = FROMFROM
		}
		text = EVTDESCF_JAPAN_221
	}
	picture = GFX_evt_melee # Best option

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challengee_won
			}
			character = FROM
		}
		name = EVTOPTA_JAPAN_221 # Yield!
		
		prestige = 10
	}
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_draw
			}
			character = FROM
		}
		name = EVTOPTB_JAPAN_221 # Well fought!
		
		prestige = 5
	}
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challenger_won
			}
			character = FROM
		}
		name = EVTOPTC_JAPAN_221 # I yield!
		
		prestige = -10
	}
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challengee_won
			}
			character = FROMFROM
		}
		name = EVTOPTD_JAPAN_221 # I yield!
		
		prestige = -10
	}
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_draw
			}
			character = FROMFROM
		}
		name = EVTOPTE_JAPAN_221 # Well fought!
		
		prestige = 5
	}
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challenger_won
			}
			character = FROMFROM
		}
		name = EVTOPTF_JAPAN_221 # Yield!
		
		prestige = 10
	}
}

# Other vassals informed of outcome
character_event = {
	id = japan.222
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challengee_won
			}
		}
		text = EVTDESCA_JAPAN_222
	}
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_draw
			}
		}
		text = EVTDESCB_JAPAN_222
	}
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challenger_won
			}
		}
		text = EVTDESCC_JAPAN_222
	}
	picture = GFX_evt_feast

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_222 # I see...
	}
}

### Food events - based on vanilla (223-227)

# Lavish Food
character_event = {
	id = japan.223
	desc = EVTDESC_JAPAN_223
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_JAPAN_223 # Approve publicly
		trigger = {
			NOT = { trait = temperate }
		}
		gain_weight_small_effect = yes
		weight_trait_check_effect = yes
		ai_chance = {
			factor = 40

			modifier = {
				factor = 5
				trait = gluttonous
			}
		}
		FROM = {
			character_event = { id = japan.226 }
		}
	}
	option = {
		name = EVTOPTB_JAPAN_223 # Disapprove
		trigger = {
			NOT = { trait = gluttonous }
		}
		ai_chance = {
			factor = 20

			modifier = {
				factor = 5
				trait = temperate
			}
		}
		FROM = {
			character_event = { id = japan.227 }
		}
	}
	option = {
		name = EVTOPTC_JAPAN_223 # Say nothing
		prestige = -10
	}
}

# Medium Food
character_event = {
	id = japan.224
	desc = EVTDESC_JAPAN_224
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_JAPAN_223 # Approve publicly
		FROM = {
			character_event = { id = japan.226 }
		}
	}
	option = {
		name = EVTOPTB_JAPAN_223 # Disapprove publicly
		FROM = {
			character_event = { id = japan.227 }
		}
	}
	option = {
		name = EVTOPTC_JAPAN_223 # Say nothing
		prestige = -10
	}
}

# Low Food
character_event = {
	id = japan.225
	desc = EVTDESC_JAPAN_225
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_JAPAN_223 #A pprove publicly
		trigger = {
			NOT = { trait = gluttonous }
		}
		ai_chance = {
			factor = 20

			modifier = {
				factor = 5
				trait = temperate
			}
		}
		FROM = {
			character_event = { id = japan.226 }
		}
	}
	option = {
		name = EVTOPTB_JAPAN_223 #A pprove publicly
		trigger = {
			NOT = { trait = temperate }
		}
		ai_chance = {
			factor = 40

			modifier = {
				factor = 5
				trait = gluttonous
			}
		}
		FROM = {
			character_event = { id = japan.227 }
		}
	}
	option = {
		name = EVTOPTC_JAPAN_223 # Say nothing
		prestige = -10
	}
}

# Liege is glad you liked the food at the feast
character_event = {
	id = japan.226
	desc = EVTDESC_JAPAN_226
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_JAPAN_226 # Good!
		opinion = {
			modifier = opinion_happy
			who = FROM
			years = 10
		}
		reverse_opinion = {
			modifier = opinion_approves
			who = FROM
			years = 10
		}
	}
}

# Liege dislikes you complaining about the food at the feast
character_event = {
	id = japan.227
	desc = EVTDESC_JAPAN_227
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_JAPAN_227 # Shut up!
		opinion = {
			modifier = opinion_irritated
			who = FROM
			years = 10
		}
		reverse_opinion = {
			modifier = opinion_disapprove
			who = FROM
			years = 10
		}
	}
}

##### Event group 3 (228-319)

### Entertainment events 2 (228-279)

# Attempt to tumble/befriend shirabyoshi?
character_event = {
	id = japan.228
	desc = EVTDESC_JAPAN_228
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:troublesome_shirabyoshi = {
				is_alive = yes
			}
		}
	}

	is_triggered_only = yes
	
	option = {
		trigger = {
			FROM = {
				event_target:troublesome_shirabyoshi = {
					OR = {
						AND = {
							trait = homosexual
							ROOT = {
								is_female = yes
								trait = homosexual
							}
						}
						AND = {
							NOT = {
								trait = homosexual
							}
							ROOT = {
								is_female = no
								NOT = {
									trait = homosexual
								}
							}
						}
					}
				}
			}
		}
		name = EVTOPTA_JAPAN_228 # Yes!
		
		piety = -5
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				character_event = { id = japan.229 days = 1 } # Shirabyoshi chooses how to respond
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				NOR = {
					trait = lustful
					trait = seducer
					trait = seductress
				}
			}
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					event_target:troublesome_shirabyoshi = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hanami_duel_bad_sport
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_228 # Try to become friends instead!
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				character_event = { id = japan.232 days = 1 } # Shirabyoshi chooses how to respond
			}
		}
		
		piety = 5
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				trait = lustful
			}
			modifier = {
				factor = 0.5
				trait = seducer
			}
			modifier = {
				factor =  0.5
				trait = seductress
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 2
				trait = zealous
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 5
				trait = paranoid
			}
			modifier = {
				factor = 0.1
				FROM = {
					event_target:troublesome_shirabyoshi = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hanami_duel_bad_sport
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_228 # I don't want to!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				FROM = {
					event_target:troublesome_shirabyoshi = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hanami_duel_good_sport
						}
					}
				}
			}
		}
	}
}

# Tumble?
character_event = {
	id = japan.229
	desc = EVTDESC_JAPAN_229
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_229 # Yes!
		
		#STDs and pregnancy
		FROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
		
		add_lover = FROM
		
		FROM = {
			character_event = { id = japan.230 }
		}
		
		piety = -5
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				NOR = {
					trait = lustful
					trait = seducer
					trait = seductress
				}
			}
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
			}
			modifier = {
				factor = 0
				has_character_modifier = dismissed_proposal # Refusing all seduction attempts!
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 10
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_good_sport
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_229 # No!
		
		piety = 5
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
		}
		
		FROM = {
			character_event = { id = japan.231 }
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				trait = lustful
			}
			modifier = {
				factor = 0.5
				trait = seducer
			}
			modifier = {
				factor =  0.5
				trait = seductress
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 2
				trait = zealous
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 5
				trait = paranoid
			}
			modifier = {
				factor = 10
				trait = chaste
			}
			modifier = {
				factor = 10
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_bad_sport
				}
			}
		}
	}
}

# Got lover
character_event = {
	id = japan.230
	desc = EVTDESC_JAPAN_230
	picture = GFX_evt_lovers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_230 # Great!
		
		add_lover = FROM
	}
}

# No lover
character_event = {
	id = japan.231
	desc = EVTDESC_JAPAN_231
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_231 # Damn!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
		
		#hidden_tooltip = {
		#	FROM = {
		#		leave_court_and_die_effect = yes
		#	}
		#}
	}
}

# Become friends?
character_event = {
	id = japan.232
	desc = EVTDESC_JAPAN_232
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		FROMFROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_232 # Yes!
		
		add_friend = FROM
		
		FROM = {
			character_event = { id = japan.233 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_bad_sport
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_232 # I don't need another friend
		
		prestige = -10
		
		FROM = {
			character_event = { id = japan.234 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_good_sport
				}
			}
		}
	}
}

# Friends!
character_event = {
	id = japan.233
	desc = EVTDESC_JAPAN_233
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_233 # Great!
		add_friend = FROM
	}
}

# Not friends!
character_event = {
	id = japan.234
	desc = EVTDESC_JAPAN_234
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_234 # Damn!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
		
		#hidden_tooltip = {
		#	FROM = {
		#		leave_court_and_die_effect = yes
		#	}
		#}
	}
}

# Troublesome shirabyoshi gets the chance to try to kill the vassal
character_event = {
	id = japan.235
	desc = EVTDESC_JAPAN_235
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	immediate = {
		any_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = hanami_duel_bad_sport
				}
			}
			save_event_target_as = shirabyoshi_foe
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_235 # Attempt to kill vassal
		
		event_target:shirabyoshi_foe = {
			character_event = { id = japan.236 } # Vassal is attacked
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			}
			modifier = {
				factor = 10
				trait = wroth
			}
			modifier = {
				factor = 10
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_235 # Do nothing
		
		prestige = 10
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_hold_back
			}
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 10
				trait = just
			}
			modifier = {
				factor = 10
				trait = craven
			}
			modifier = {
				factor = 10
				trait = content
			}
			modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Vassal being attacked selects response
character_event = {
	id = japan.236
	desc = EVTDESC_JAPAN_236
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_236 # Fight
		
		hidden_tooltip = {
			random_list = {
				50 = {
					modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value = 10
						}
					}
					modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value = 20
						}
					}
					modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value = 30
						}
					}
					modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value = 40
						}
					}
					random_list = {
						70 = {
							character_event = { id = japan.241 days = 1} # Victory, no wounds
						}
						20 = {
							character_event = { id = japan.243 days = 1} # Victory - wounded
						}
						10 = {
							character_event = { id = japan.245 days = 1} # Victory - maimed
						}
					}
				}
				50 = {
					modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value = 10
							}
						}
					}
					modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value = 20
							}
						}
					}
					modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value = 30
							}
						}
					}
					modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value = 40
							}
						}
					}
					random_list = {
						70 = {}
						20 = {
							FROM = {
								add_trait = wounded
								set_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
							}
						}
						10 = {
							FROM = {
								add_maimed_trait_effect = yes
								set_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
							}
						}
					}
					character_event = { id = japan.247 days = 1} # Died
				}
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			}
			modifier = {
				factor = 10
				trait = wroth
			}
			modifier = {
				factor = 10
				trait = brave
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_236 # Flee
		
		prestige = -10
		
		hidden_tooltip = {
			random_list = {
				50 = {
					character_event = { id = japan.237 days = 1 } # Survived
				}
				50 = {
					character_event = { id = japan.239 days = 1 } # Died
				}
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_hold_back
			}
			modifier = {
				factor = 100
				trait = craven
			}
		}
	}
}

# Fled and lived
character_event = {
	id = japan.237
	desc = EVTDESC_JAPAN_237
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_237 # Phew!
		
		FROMFROMFROM = {
			character_event = { id = japan.238 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = japan.238
	desc = EVTDESC_JAPAN_238
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	immediate = {
		event_target:troublesome_shirabyoshi = {
			leave_court_and_die_effect = yes
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_238 # I see...
	}
}

# Fled and died
character_event = {
	id = japan.239
	desc = EVTDESC_JAPAN_239
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_239 # NOOOO!
		
		if = {
			limit = {
				FROMFROMFROM = {
					NOT = {
						intrigue = 16
					}
				}
				NOT = {
					FROMFROM = {
						has_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
					}
				}
			}
			death = {
				death_reason = death_murder_unknown
				killer = FROMFROM
			}
		}
		if = {
			limit = {
				OR = {
					FROMFROMFROM = {
						intrigue = 16
					}
					FROMFROM = {
						has_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
					}
				}
			}
			death = {
				death_reason = death_murder
				killer = FROMFROM
			}
		}
		
		FROMFROMFROM = {
			character_event = { id = japan.240 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = japan.240
	desc = EVTDESC_JAPAN_240
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	#immediate = {
	#	event_target:troublesome_shirabyoshi = {
	#		leave_court_and_die_effect = yes
	#	}
	#}
	
	option = {
		trigger = {
			NOR = {
				intrigue = 8
				FROMFROMFROM = {
					has_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
				}
			}
		}
		name = EVTOPTA_JAPAN_240 # Who could have done this?
	}
	
	option = {
		trigger = {
			intrigue = 8
			NOR = {
				intrigue = 16
				FROMFROMFROM = {
					has_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
				}
			}
		}
		name = EVTOPTB_JAPAN_240 # I have my suspicions...
		
		opinion = {
			who = event_target:troublesome_shirabyoshi
			modifier = opinion_acting_suspicious
		}
	}
	
	option = {
		trigger = {
			OR = {
				intrigue = 16
				FROMFROMFROM = {
					has_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
				}
			}
		}
		name = EVTOPTC_JAPAN_240 # I know who did this!
		
		opinion = {
			who = event_target:troublesome_shirabyoshi
			modifier = opinion_dishonorable
		}
	}
}

# Fought and lived
character_event = {
	id = japan.241
	desc = EVTDESC_JAPAN_241
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_241 # Phew!
		
		FROMFROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		FROMFROMFROM = {
			character_event = { id = japan.242 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = japan.242
	desc = EVTDESC_JAPAN_242
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_242 # I see...
	}
}

# Fought and lived - wounded
character_event = {
	id = japan.243
	desc = EVTDESC_JAPAN_243
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_243 # 'Tis but a scratch!
		
		FROMFROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		add_trait = wounded
		
		FROMFROMFROM = {
			character_event = { id = japan.244 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = japan.244
	desc = EVTDESC_JAPAN_244
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_244 # I see...
	}
}

# Fought and lived - maimed
character_event = {
	id = japan.245
	desc = EVTDESC_JAPAN_245
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_245 # At least I still live...
		
		FROMFROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		add_maimed_trait_effect = yes
		
		FROMFROMFROM = {
			character_event = { id = japan.246 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = japan.246
	desc = EVTDESC_JAPAN_246
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_246 # I see...
	}
}

# Fought and died
character_event = {
	id = japan.247
	desc = EVTDESC_JAPAN_247
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_247 # NOOOO!
		
		death = {
			death_reason = death_duel
			killer = FROMFROM
		}
		
		FROMFROMFROM = {
			character_event = { id = japan.248 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = japan.248
	desc = EVTDESC_JAPAN_248
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	immediate = {
		event_target:troublesome_shirabyoshi = {
			leave_court_and_die_effect = yes
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_248 # I see...
	}
}

# Vassal - attack shirabyoshi?
character_event = {
	id = japan.249
	desc = EVTDESC_JAPAN_249
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
		any_opinion_modifier_target = {
			has_opinion_modifier = {
				who = ROOT
				modifier = hanami_duel_bad_sport
			}
			is_landed = no
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_249 # Attempt to kill shirabyoshi
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = hanami_duel_bad_sport
				}
			}
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			hidden_tooltip = {
				random_list = {
					50 = {
						modifier = {
							factor = 2
							combat_rating_diff = {
								who = ROOT
								value = 10
							}
						}
						modifier = {
							factor = 2
							combat_rating_diff = {
								who = ROOT
								value = 20
							}
						}
						modifier = {
							factor = 2
							combat_rating_diff = {
								who = ROOT
								value = 30
							}
						}
						modifier = {
							factor = 2
							combat_rating_diff = {
								who = ROOT
								value = 40
							}
						}
						random_list = {
							70 = {
								ROOT = {
									character_event = { id = japan.254 days = 1} # Died, shirabyoshi unharmed
								}
							}
							20 = {
								add_trait = wounded
								ROOT = {
									character_event = { id = japan.255 days = 1} # Died, shirabyoshi wounded
								}
							}
							10 = {
								FROM = {
									add_maimed_trait_effect = yes
									ROOT = {
										character_event = { id = japan.256 days = 1} # Died, shirabyoshi maimed
									}
								}
							}
						}
					}
					50 = {
						modifier = {
							factor = 2
							ROOT = {
								combat_rating_diff = {
									who = PREV
									value = 10
								}
							}
						}
						modifier = {
							factor = 2
							ROOT = {
								combat_rating_diff = {
									who = PREV
									value = 20
								}
							}
						}
						modifier = {
							factor = 2
							ROOT = {
								combat_rating_diff = {
									who = PREV
									value = 30
								}
							}
						}
						modifier = {
							factor = 2
							ROOT = {
								combat_rating_diff = {
									who = PREV
									value = 40
								}
							}
						}
						random_list = {
							70 = {
								ROOT = {
									character_event = { id = japan.250 days = 1} # Victory, no wounds
								}
							}
							20 = {
								ROOT = {
									character_event = { id = japan.251 days = 1} # Victory - wounded
								}
							}
							10 = {
								ROOT = {
									character_event = { id = japan.252 days = 1} # Victory - wounded
								}
							}
						}
					}
				}
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			}
			modifier = {
				factor = 10
				trait = wroth
			}
			modifier = {
				factor = 10
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_249 # Do nothing
		
		prestige = 10
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_hold_back
			}
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 10
				trait = just
			}
			modifier = {
				factor = 10
				trait = craven
			}
			modifier = {
				factor = 10
				trait = content
			}
			modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Killed shirabyoshi
character_event = {
	id = japan.250
	desc = EVTDESC_JAPAN_250
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_250 # Good riddance!
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = hanami_duel_bad_sport
				}
			}
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		FROMFROMFROM = {
			character_event = { id = japan.253 } # Inform liege
		}
	}
}

# Killed shirabyoshi - wounded
character_event = {
	id = japan.251
	desc = EVTDESC_JAPAN_251
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_251 # 'Tis but a scratch!
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = hanami_duel_bad_sport
				}
			}
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = yes
						}
					}
					detract_grace_major_effect = yes
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = no
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_medium_effect = yes
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = no
							NOT = {
								any_close_relative = {
									dynasty = PREV
									is_chinese_emperor_trigger = yes
								}
							}
							any_dynasty_member = {
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_minor_effect = yes
				}
			}
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		add_trait = wounded
		
		FROMFROMFROM = {
			character_event = { id = japan.253 } # Inform liege
		}
	}
}

# Killed shirabyoshi - maimed
character_event = {
	id = japan.252
	desc = EVTDESC_JAPAN_252
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_252 # At least I still live...
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = hanami_duel_bad_sport
				}
			}
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = yes
						}
					}
					detract_grace_super_huge_effect = yes
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = no
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_massive_effect = yes
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = no
							NOT = {
								any_close_relative = {
									dynasty = PREV
									is_chinese_emperor_trigger = yes
								}
							}
							any_dynasty_member = {
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_major_effect = yes
				}
			}
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		add_maimed_trait_effect = yes
		
		FROMFROMFROM = {
			character_event = { id = japan.253 } # Inform liege
		}
	}
}

# Inform liege
character_event = {
	id = japan.253
	desc = EVTDESC_JAPAN_253
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_253 # I see...
	}
}

# Killed by shirabyoshi
character_event = {
	id = japan.254
	desc = EVTDESC_JAPAN_254
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_254 # NOOO!
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = hanami_duel_bad_sport
				}
			}
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = yes
						}
					}
					detract_grace_super_huge_effect = yes
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = no
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_massive_effect = yes
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = no
							NOT = {
								any_close_relative = {
									dynasty = PREV
									is_chinese_emperor_trigger = yes
								}
							}
							any_dynasty_member = {
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_major_effect = yes
				}
			}
			ROOT = {
				death = {
					death_reason = death_duel
					killer = PREV
				}
			}
		}
		
		FROMFROMFROM = {
			character_event = { id = japan.257 } # Inform liege
		}
	}
}

# Killed by shirabyoshi - shirabyoshi wounded
character_event = {
	id = japan.255
	desc = EVTDESC_JAPAN_255
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_255 # NOOO!
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = hanami_duel_bad_sport
				}
			}
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = yes
						}
					}
					detract_grace_super_huge_effect = yes
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = no
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_massive_effect = yes
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = no
							NOT = {
								any_close_relative = {
									dynasty = PREV
									is_chinese_emperor_trigger = yes
								}
							}
							any_dynasty_member = {
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_major_effect = yes
				}
			}
			ROOT = {
				death = {
					death_reason = death_duel
					killer = PREV
				}
			}
		}
		
		FROMFROMFROM = {
			character_event = { id = japan.257 } # Inform liege
		}
	}
}

# Killed by shirabyoshi - shirabyoshi maimed
character_event = {
	id = japan.256
	desc = EVTDESC_JAPAN_256
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_256 # NOOO!
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = hanami_duel_bad_sport
				}
			}
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = yes
						}
					}
					detract_grace_super_huge_effect = yes
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = no
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_massive_effect = yes
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = no
							NOT = {
								any_close_relative = {
									dynasty = PREV
									is_chinese_emperor_trigger = yes
								}
							}
							any_dynasty_member = {
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_major_effect = yes
				}
			}
			ROOT = {
				death = {
					death_reason = death_duel
					killer = PREV
				}
			}
		}
		
		FROMFROMFROM = {
			character_event = { id = japan.257 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = japan.257
	desc = EVTDESC_JAPAN_257
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_257 # She was only defending herself!
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			opinion = {
				who = ROOT
				modifier = opinion_outraged
			}
			if = {
				limit = {
					ai = no
				}
				character_event = { id = japan.258 } # Vassals informed
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				trait = just
			}
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 0
				FROM = {
					dynasty = ROOT
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_257 # Get out of my sight!
		
		event_target:troublesome_shirabyoshi = {
			leave_court_and_die_effect = yes
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			opinion = {
				who = ROOT
				modifier = opinion_upset
			}
			if = {
				limit = {
					ai = no
				}
				character_event = { id = japan.259 } # Vassals informed
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				trait = wroth
			}
			modifier = {
				factor = 10
				trait = arbitrary
			}
			modifier = {
				factor = 0
				FROM = {
					dynasty = ROOT
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_257 # Seize her!
		
		event_target:troublesome_shirabyoshi = {
			imprison = yes
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			character_event = { id = japan.260 } # Vassals informed
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				trait = just
				FROM = {
					NOT = {
						dynasty = ROOT
					}
				}
			}
			modifier = {
				factor = 0
				trait = kind
				FROM = {
					NOT = {
						dynasty = ROOT
					}
				}
			}
		}
	}
}

# Vassals informed - shirabyoshi remains free
character_event = {
	id = japan.258
	desc = EVTDESC_JAPAN_258
	picture = GFX_evt_scandal

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_258 # Why is she free?
	}
}

# Vassals informed - shirabyoshi banished
character_event = {
	id = japan.259
	desc = EVTDESC_JAPAN_259
	picture = GFX_evt_scandal

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_259 # Why is she free?
	}
}

# Vassals informed - shirabyoshi imprisoned
character_event = {
	id = japan.260
	desc = EVTDESC_JAPAN_260
	picture = GFX_evt_into_the_dungeon

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_260 # Good!
	}
}

# Female dynasty member taught to fight
character_event = {
	id = japan.261
	desc = EVTDESC_JAPAN_261
	picture = GFX_evt_courtiers_talking

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:troublesome_shirabyoshi = {
				is_alive = yes
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_261 # I have a new best friend!
		
		add_trait = duelist
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				add_friend = ROOT
			}
		}
		
		FROM = {
			character_event = { id = japan.262 }
		}
	}
}

# Inform liege
character_event = {
	id = japan.262
	desc = EVTDESC_JAPAN_262
	picture = GFX_evt_courtiers_talking

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_262 # I see...
	}
}


# Attempt to tumble/befriend shirabyoshi?
character_event = {
	id = japan.263
	desc = EVTDESC_JAPAN_263
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
		event_target:remarkable_shirabyoshi = {
			is_alive = yes
		}
	}

	is_triggered_only = yes
	
	option = {
		trigger = {
			event_target:remarkable_shirabyoshi = {
				OR = {
					AND = {
						trait = homosexual
						ROOT = {
							is_female = yes
							trait = homosexual
						}
					}
					AND = {
						NOT = {
							trait = homosexual
						}
						ROOT = {
							is_female = no
							NOT = {
								trait = homosexual
							}
						}
					}
				}
			}
		}
		name = EVTOPTA_JAPAN_263 # Yes!
		
		piety = -5
		
		event_target:troublesome_shirabyoshi = {
			character_event = { id = japan.264 days = 1 } # Shirabyoshi chooses how to respond
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				NOR = {
					trait = lustful
					trait = seducer
					trait = seductress
				}
			}
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					event_target:troublesome_shirabyoshi = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hanami_duel_bad_sport
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_263 # Try to become friends instead!
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				character_event = { id = japan.267 days = 1 } # Shirabyoshi chooses how to respond
			}
		}
		
		piety = 5
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				trait = lustful
			}
			modifier = {
				factor = 0.5
				trait = seducer
			}
			modifier = {
				factor =  0.5
				trait = seductress
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 2
				trait = zealous
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 5
				trait = paranoid
			}
			modifier = {
				factor = 0.1
				FROM = {
					event_target:troublesome_shirabyoshi = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hanami_duel_bad_sport
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_263 # I don't want to!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				FROM = {
					event_target:troublesome_shirabyoshi = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hanami_duel_good_sport
						}
					}
				}
			}
		}
	}
}

# Tumble?
character_event = {
	id = japan.264
	desc = EVTDESC_JAPAN_264
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_264 # Yes!
		
		#STDs and pregnancy
		FROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
		
		add_lover = FROM
		
		FROM = {
			character_event = { id = japan.265 }
		}
		
		piety = -5
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				NOR = {
					trait = lustful
					trait = seducer
					trait = seductress
				}
			}
			modifier = {
				factor = 0
				spouse = {
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
			}
			modifier = {
				factor = 0
				has_character_modifier = dismissed_proposal # Refusing all seduction attempts!
			}
			modifier = {
				factor = 0
				trait = celibate
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_264 # No!
		
		piety = 5
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
		}
		
		FROM = {
			character_event = { id = japan.266 }
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				trait = lustful
			}
			modifier = {
				factor = 0.5
				trait = seducer
			}
			modifier = {
				factor =  0.5
				trait = seductress
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 2
				trait = zealous
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 5
				trait = paranoid
			}
			modifier = {
				factor = 10
				trait = chaste
			}
		}
	}
}

# Got lover
character_event = {
	id = japan.265
	desc = EVTDESC_JAPAN_265
	picture = GFX_evt_lovers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_265 # Great!
		
		add_lover = FROM
	}
}

# No lover
character_event = {
	id = japan.266
	desc = EVTDESC_JAPAN_266
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_266 # Damn!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
		
		#hidden_tooltip = {
		#	FROM = {
		#		leave_court_and_die_effect = yes
		#	}
		#}
	}
}

# Become friends?
character_event = {
	id = japan.267
	desc = EVTDESC_JAPAN_267
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_267 # Yes!
		
		add_friend = FROM
		
		FROM = {
			character_event = { id = japan.268 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_bad_sport
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_267 # I don't need another friend
		
		prestige = -10
		
		FROM = {
			character_event = { id = japan.269 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_good_sport
				}
			}
		}
	}
}

# Friends!
character_event = {
	id = japan.268
	desc = EVTDESC_JAPAN_268
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_268 # Great!
		add_friend = FROM
	}
}

# Not friends!
character_event = {
	id = japan.269
	desc = EVTDESC_JAPAN_269
	picture = GFX_evt_quarrel

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_269 # Damn!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
		
		#hidden_tooltip = {
		#	FROM = {
		#		leave_court_and_die_effect = yes
		#	}
		#}
	}
}

# Remarkable shirabyoshi keeps on impressing people
character_event = {
	id = japan.270
	desc = EVTDESC_JAPAN_270
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_270 # Great!
		
		prestige = 50
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			opinion = {
				who = ROOT
				modifier = good_hanami
				months = 12
			}
			if = {
				limit = {
					ai = no
				}
				character_event = { id = japan.271 } # Inform vassals
			}
		}
	}
}

# Remarkable shirabyoshi - vassal
character_event = {
	id = japan.271
	desc = EVTDESC_JAPAN_271
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_271 # She's good!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

# Make the shirabyoshi a commander?
character_event = {
	id = japan.272
	desc = EVTDESC_JAPAN_272
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_272 # Yes!
		

		if = {
			limit = {
				OR = {
					NOT = {
						has_dlc = "Conclave"
					}
					primary_title = {
						NOT = {
							has_law = status_of_women_4
						}
					}
				}
			}
			any_vassal = {
				opinion = {
					who = ROOT
					modifier = opinion_outraged
				}
				if = {
					limit = {
						ai = no
						has_character_flag = coming_to_hanami
					}
					character_event = { id = japan.273 } # Inform vassals
				}
			}
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 10
				is_female = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_272 # No!
		
		ai_chance = {
			factor = 75
		}
	}
}

# Vassal informed
character_event = {
	id = japan.273
	desc = EVTDESC_JAPAN_273
	picture = GFX_evt_scandal

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		trigger = {
			is_female = no
		}
		name = EVTOPTA_JAPAN_273 # That's just wrong!
	}
	
	option = {
		trigger = {
			is_female = yes
		}
		name = EVTOPTB_JAPAN_273 # Why is *she* allowed to command?
	}
}

# Shirabyoshi perform well
character_event = {
	id = japan.274
	desc = EVTDESC_JAPAN_274
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_274 # Good!
		
		prestige = 10
		
		random_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
				is_inaccessible_or_incapable_trigger = no
				prisoner = no
			}
			opinion = {
				who = ROOT
				modifier = good_hanami
				months = 12
			}
			if = {
				limit = {
					ai = no
				}
				character_event = { id = japan.275 } # Inform vassals
			}
		}
	}
}

# Shirabyoshi perform well - vassals
character_event = {
	id = japan.275
	desc = EVTDESC_JAPAN_275
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_275 # She's good!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

# Vassal insulted by shirabyoshi
character_event = {
	id = japan.276
	desc = EVTDESC_JAPAN_276
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_276 # How rude!
		
		FROM = {
			character_event = { id = japan.277 days = 1 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = japan.277
	desc = EVTDESC_JAPAN_277
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_277 # Throw them out!
		
		prestige = -10
		
		FROM = {
			character_event = { id = japan.278 } # Inform vassal
			
			opinion = {
				who = ROOT
				modifier = good_hanami
				months = 12
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = FROM
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_277 # I don't care!
		
		FROM = {
			character_event = { id = japan.279 } # Inform vassal
			
			opinion = {
				who = ROOT
				modifier = bad_hanami
				months = 12
			}
		}
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				opinion = {
					who = FROM
					value = 25
				}
			}
		}
	}
}

# Shirabyoshi thrown out
character_event = {
	id = japan.278
	desc = EVTDESC_JAPAN_278
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_278 # Good!
	}
}

# Shirabyoshi allowed to stay
character_event = {
	id = japan.279
	desc = EVTDESC_JAPAN_279
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_279 # I don't like it!
	}
}

### Daytime events 2 (280-288)

# Become friends?
character_event = {
	id = japan.280
	desc = EVTDESC_JAPAN_280
	picture = GFX_evt_children_talking

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_child_friend_rival = {
				is_alive = yes
				is_inaccessible_or_incapable_trigger = no
				prisoner = no
			}
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_280 # I should speak more with X
		FROM = {
			event_target:hanami_child_friend_rival = {
				character_event = { id = japan.281 days = 1 }
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_177 # I don't need another friend
		
		ai_chance = {
			factor = 0
		}
	}
}

# Become friends?
character_event = {
	id = japan.281
	desc = EVTDESC_JAPAN_281
	picture = GFX_evt_children_talking

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_281 # I should speak more with X
		add_friend = FROM
		FROM = {
			character_event = { id = japan.282 }
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_281 # I don't need another friend
		
		prestige = -5
		
		FROM = {
			character_event = { id = japan.282 }
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Inform FROM
character_event = {
	id = japan.282
	desc = {
		trigger = {
			any_friend = {
				character = FROM
			}
		}
		text = EVTDESCA_JAPAN_282
	}
	desc = {
		trigger = {
			NOT = {
				any_friend = {
					character = FROM
				}
			}
		}
		text = EVTDESCB_JAPAN_282
	}
	picture = GFX_evt_children_talking

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			any_friend = {
				character = FROM
			}
		}
		name = EVTOPTA_JAPAN_282 # Good!
		
		add_friend = FROM
	}
	
	option = {
		trigger = {
			NOT = {
				any_friend = {
					character = FROM
				}
			}
		}
		name = EVTOPTB_JAPAN_282 # Rude!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
	}
}

# 283 - unused

# Become rivals?
character_event = {
	id = japan.284
	desc = EVTDESC_JAPAN_284
	picture = GFX_evt_child_play

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_child_friend_rival = {
				is_alive = yes
				is_inaccessible_or_incapable_trigger = yes
				prisoner = no
			}
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_284 # They'd better apologize!
		FROM = {
			event_target:hanami_child_friend_rival = {
				character_event = { id = japan.285 days = 1 }
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_284 # Let's not make matters worse
		
		prestige = -5
		
		ai_chance = {
			factor = 0
		}
	}
}

# Become rivals?
character_event = {
	id = japan.285
	desc = EVTDESC_JAPAN_285
	picture = GFX_evt_child_play

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_285 # I hate you too!
		add_rival = FROM
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
				FROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
		FROM = {
			character_event = { id = japan.286 }
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_285 # Let's make amends
		
		prestige = -5
		
		FROM = {
			character_event = { id = japan.286 }
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Inform FROM
character_event = {
	id = japan.286
	desc = {
		trigger = {
			any_rival = {
				character = FROM
			}
		}
		text = EVTDESCA_JAPAN_286
	}
	desc = {
		trigger = {
			NOT = {
				any_rival = {
					character = FROM
				}
			}
		}
		text = EVTDESCB_JAPAN_286
	}
	picture = GFX_evt_child_play

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			any_rival = {
				character = FROM
			}
		}
		name = EVTOPTA_JAPAN_286 # You're going down!
		
		add_rival = FROM
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = yes
					}
				}
				detract_grace_major_effect = yes
			}
			if = {
				limit = {
					FROM = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_medium_effect = yes
			}
			if = {
				limit = {
				FROM = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_minor_effect = yes
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				any_rival = {
					character = FROM
				}
			}
		}
		name = EVTOPTB_JAPAN_286 # Very well!
		
		opinion = {
			who = FROM
			modifier = opinion_glad
			months = 12
		}
	}
}

# 287 - unused

# The weather worsens
character_event = {
	id = japan.288
	desc = EVTDESC_JAPAN_288
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_288 # I should have picked a better day!
		
		prestige = -10
	}
}

### Nighttime events 2 (289-309)

# A wild fireworks merchant appears!
character_event = {
	id = japan.289
	desc = EVTDESC_JAPAN_289
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		trigger = {
			wealth = 10
		}
		
		name = EVTOPTA_JAPAN_289 # Give me some small ones!
		
		wealth = -10
		
		character_event = { id = japan.290 days = 1 } # Small fireworks
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		trigger = {
			wealth = 25
		}
		
		name = EVTOPTB_JAPAN_289 # Give me some medium ones!
		
		random_list = {
			75 = {
				character_event = { id = japan.292 days = 1 } # Medium fireworks - all is well
			}
			25 = {
				modifier = {
					factor = 0
					learning = 16
				}
				modifier = {
					factor = 0.1
					learning = 8
				}
				character_event = { id = japan.294 days = 1 } # Medium fireworks - maimed
			}
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.1
				trait = greedy
			}
			modifier = {
				factor = 0.1
				NOR = {
					trait = lunatic
					trait = possessed
					trait = imbecile
					learning = 8
				}
			}
		}
	}
	
	option = {
		trigger = {
			wealth = 100
		}
		
		name = EVTOPTC_JAPAN_289 # Give me the biggest fireworks you have!
		
		random_list = {
			45 = {
				character_event = { id = japan.296 days = 1 } # Huge fireworks - all is well
			}
			30 = {
				modifier = {
					factor = 0.1
					learning = 32
				}
				modifier = {
					factor = 0.1
					learning = 24
				}
				modifier = {
					factor = 0.1
					learning = 16
				}
				character_event = { id = japan.298 days = 1 } # Huge fireworks - maimed
			}
			20 = {
				modifier = {
					factor = 0.1
					learning = 28
				}
				modifier = {
					factor = 0.1
					learning = 20
				}
				modifier = {
					factor = 0.1
					learning = 12
				}
				random_courtier = {
					limit = {
						prisoner = no
						is_inaccessible_or_incapable_trigger = no
					}
					save_event_target_as = fireworks_victim
				}
				character_event = { id = japan.300 days = 1 } # Huge fireworks - bystander killed
			}
			5 = {
				modifier = {
					factor = 0.1
					learning = 24
				}
				modifier = {
					factor = 0.1
					learning = 16
				}
				modifier = {
					factor = 0.1
					learning = 8
				}
				random_courtier = {
					limit = {
						prisoner = no
						is_inaccessible_or_incapable_trigger = no
					}
					save_event_target_as = fireworks_victim
				}
				random_courtier = {
					limit = {
						prisoner = no
						is_inaccessible_or_incapable_trigger = no
						event_target:fireworks_victim = {
							NOT = {
								character = PREV
							}
						}
					}
					save_event_target_as = fireworks_victim_2
				}
				random = {
					chance = 50
					random_courtier = {
						limit = {
							prisoner = no
							is_inaccessible_or_incapable_trigger = no
							event_target:fireworks_victim = {
								NOT = {
									character = PREV
								}
							}
							event_target:fireworks_victim_2 = {
								NOT = {
									character = PREV
								}
							}
						}
						save_event_target_as = fireworks_victim_3
					}
					random = {
						chance = 50
						random_courtier = {
							limit = {
								prisoner = no
								is_inaccessible_or_incapable_trigger = no
								event_target:fireworks_victim = {
									NOT = {
										character = PREV
									}
								}
								event_target:fireworks_victim_2 = {
									NOT = {
										character = PREV
									}
								}
								event_target:fireworks_victim_3 = {
									NOT = {
										character = PREV
									}
								}
							}
							save_event_target_as = fireworks_victim_4
						}
						random = {
							chance = 50
							random_courtier = {
								limit = {
									prisoner = no
									is_inaccessible_or_incapable_trigger = no
									event_target:fireworks_victim = {
										NOT = {
											character = PREV
										}
									}
									event_target:fireworks_victim_2 = {
										NOT = {
											character = PREV
										}
									}
									event_target:fireworks_victim_3 = {
										NOT = {
											character = PREV
										}
									}
									event_target:fireworks_victim_4 = {
										NOT = {
											character = PREV
										}
									}
								}
								save_event_target_as = fireworks_victim_5
							}
						}
					}
				}
				narrative_event = { id = japan.303 days = 1 } # Huge fireworks - catastrophe
			}
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				trait = greedy
			}
			modifier = {
				factor = 0.1
				NOR = {
					trait = lunatic
					trait = possessed
					trait = imbecile
					learning = 16
				}
			}
		}
	}
	
	option = {
		name = EVTOPTD_JAPAN_289 # I can't afford this!
		
		prestige = -10
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				wealth = 10
				NOT = {
					trait = greedy
				}
			}
		}
	}
}

# Small fireworks
character_event = {
	id = japan.290
	desc = EVTDESC_JAPAN_290
	picture = GFX_evt_comet

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_290 # That was nice!
		
		prestige = 10
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			character_event = { id = japan.291 }
		}
	}
}

# Small fireworks - vassals
character_event = {
	id = japan.291
	desc = EVTDESC_JAPAN_291
	picture = GFX_evt_comet

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_291 # That was nice!
	}
}

# Medium fireworks - all is well
character_event = {
	id = japan.292
	desc = EVTDESC_JAPAN_292
	picture = GFX_evt_comet

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_292 # That was nice!
		
		prestige = 25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			character_event = { id = japan.293 }
		}
	}
}

# Medium fireworks - all is well - vassals
character_event = {
	id = japan.293
	desc = EVTDESC_JAPAN_293
	picture = GFX_evt_comet

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_293 # That was nice!
	}
}

# Medium fireworks - maimed
character_event = {
	id = japan.294
	desc = EVTDESC_JAPAN_294
	picture = GFX_evt_shadowy_cabal

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_294 # Ow!
		
		add_maimed_trait_effect = yes
		
		prestige = -5
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			character_event = { id = japan.295 }
		}
	}
}

# Medium fireworks - maimed - vassals
character_event = {
	id = japan.295
	desc = EVTDESC_JAPAN_295
	picture = GFX_evt_shadowy_cabal

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_295 # Play with fire...
	}
}

# Huge fireworks - all is well
character_event = {
	id = japan.296
	desc = EVTDESC_JAPAN_296
	picture = GFX_evt_comet

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_296 # A most impressive display!
		
		prestige = 100
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			opinion = {
				who = ROOT
				modifier = good_hanami
			}
			if = {
				limit = {
					ai = no
				}
				character_event = { id = japan.297 }
			}
		}
	}
}

# Huge fireworks - all is well - vassals
character_event = {
	id = japan.297
	desc = EVTDESC_JAPAN_297
	picture = GFX_evt_comet

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_297 # A most impressive display!
	}
}

# Huge fireworks - maimed
character_event = {
	id = japan.298
	desc = EVTDESC_JAPAN_298
	picture = GFX_evt_shadowy_cabal

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_298 # Ow!
		
		add_maimed_trait_effect = yes
		
		prestige = -5
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			character_event = { id = japan.299 }
		}
	}
}

# Huge fireworks - maimed - vassals
character_event = {
	id = japan.299
	desc = EVTDESC_JAPAN_299
	picture = GFX_evt_shadowy_cabal

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_299 # Play with fire...
	}
}

# Huge fireworks - dead bystander
character_event = {
	id = japan.300
	desc = EVTDESC_JAPAN_300
	picture = GFX_evt_death

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
		event_target:fireworks_victim = {
			is_alive = yes
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_300 # Oh no!
		
		prestige = -25
		
		show_portrait = event_target:fireworks_victim
		show_portrait = event_target:fireworks_victim_2
		
		event_target:fireworks_victim = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			character_event = { id = japan.301 }
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			character_event = { id = japan.302 }
		}
	}
}

# Huge fireworks - dead bystanders - target
character_event = {
	id = japan.301
	desc = EVTDESC_JAPAN_301
	picture = GFX_evt_death

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_301 # No!
		
		death = {
			death_reason = death_accident
			killer = FROM
		}
	}
}

# Huge fireworks - dead bystander - vassals
character_event = {
	id = japan.302
	desc = EVTDESC_JAPAN_302
	picture = GFX_evt_death

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_302 # This is bad!
	}
}

# Huge fireworks - catastrophe
narrative_event = {
	id = japan.303
	title = EVTTITLE_JAPAN_303
	desc = EVTDESC_JAPAN_303
	picture = GFX_evt_irminsul_burning
	border = GFX_event_narrative_frame_diplomacy

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_303 # This is a disaster!
		
		prestige = -200
		
		capital_scope = {
			capital_holding = {
				destroy_random_building = yes
				random = {
					chance = 50
					destroy_random_building = yes
					random = {
						chance = 50
						destroy_random_building = yes
						random = {
							chance = 50
							destroy_random_building = yes
							random = {
								chance = 50
								destroy_random_building = yes
							}
						}
					}
				}
			}
		}
		
		show_portrait = event_target:fireworks_victim
		show_portrait = event_target:fireworks_victim_2
		show_portrait = event_target:fireworks_victim_3
		show_portrait = event_target:fireworks_victim_4
		show_portrait = event_target:fireworks_victim_5
		
		capital_scope = {
			if = {
				limit = {
					has_dlc = "Reapers"
				}
				increase_depopulation_effect = yes
			}
			add_province_modifier = {
				name = peasants_upset
				duration = 3650
			}
		}
		
		event_target:fireworks_victim = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			character_event = { id = japan.301 }
		}
		event_target:fireworks_victim_2 = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			character_event = { id = japan.301 }
		}
		event_target:fireworks_victim_3 = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			character_event = { id = japan.301 }
		}
		event_target:fireworks_victim_4 = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			character_event = { id = japan.301 }
		}
		event_target:fireworks_victim_5 = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			character_event = { id = japan.301 }
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			narrative_event = { id = japan.304 }
		}
	}
}

# Huge fireworks - catastrophe - vassals
narrative_event = {
	id = japan.304
	title = EVTTITLE_JAPAN_304
	desc = EVTDESC_JAPAN_304
	picture = GFX_evt_irminsul_burning
	border = GFX_event_narrative_frame_diplomacy

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_304 # What was FROM thinking?
	}
}

# Comet sighted!
character_event = {
	id = japan.305
	desc = EVTDESC_JAPAN_305
	picture = GFX_evt_comet
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_305
		
		prestige = -1
		
		custom_tooltip = {
			text = EVTTOOLTIP_JAPAN_305 # Lose 1 Stability (no actual effect)
		}
	}
}

# Learn about astronomy - obsolete
#character_event = {
#	id = japan.306
#	desc = EVTDESC_JAPAN_306
#	picture = GFX_evt_feast
#	
#	only_rulers = yes
#	capable_only = yes
#	prisoner = no
#	war = no
#	
#	is_triggered_only = yes
#	
#	trigger = {
#		has_character_modifier = hanami_in_progress
#	}
#	
#	option = {
#		trigger = {
#			NOT = {
#				lifestyle_traits = 1
#			}
#		}
#		name = EVTOPTA_JAPAN_306 # Become scholar
#		
#		add_trait = scholar
#		
#		ai_chance = {
#			factor = 25
#		}
#	}
#	
#	option = {
#		trigger = {
#			NOT = {
#				trait = scholar
#			}
#		}
#		name = EVTOPTB_JAPAN_306 # Get prestige
#		
#		prestige = 25
#		
#		ai_chance = {
#			factor = 75
#		}
#	}
#	
#	option = {
#		trigger = {
#			trait = scholar
#		}
#		name = EVTOPTB_JAPAN_306 # Get prestige
#		
#		prestige = 50
#		
#		ai_chance = {
#			factor = 100
#		}
#	}
#}

# Fall in love with spouse
character_event = {
	id = japan.307
	desc = EVTDESC_JAPAN_307
	picture = GFX_evt_comet
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_307 # This is love!
		
		spouse = {
			add_lover = ROOT
		}
	}
}

# Befriend child
character_event = {
	id = japan.308
	desc = EVTDESC_JAPAN_308
	picture = GFX_evt_comet
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	immediate = {
		random_child = {
			limit = {
				prisoner = no
				is_inaccessible_or_incapable_trigger = no
				host = {
					character = ROOT
				}
				NOR = {
					any_friend = {
						character = ROOT
					}
					any_rival = {
						character = ROOT
					}
				}
				opinion = {
					who = ROOT
					value = 0
				}
			}
			save_event_target_as = hanami_child_friend
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_308 # Sounds good!
		
		event_target:hanami_child_friend = {
			add_friend = ROOT
		}
	}
}

# Calm, uneventful night
character_event = {
	id = japan.309
	desc = EVTDESC_JAPAN_309
	picture = GFX_evt_comet
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_309 # Just enjoy the view
		
		prestige = 10
	}
}

### Misc events 2 (310-319)

# Sword practice
character_event = {
	id = japan.310
	desc = EVTDESC_JAPAN_310
	picture = GFX_evt_feast
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_310 # Let's do it!
		
		random_list = {
			25 = {
				modifier = {
					factor = 0
					OR = {
						trait = brave
						trait = craven
					}
				}
				set_character_flag = hanami_brave
			}
			25 = {
				modifier = {
					factor = 0
					NOT = {
						trait = craven
					}
				}
				set_character_flag = hanami_not_craven
			}
			100 = {
				set_character_flag = hanami_prestige
			}
			25 = {
				set_character_flag = hanami_wounded
			}
			25 = {
				modifier = {
					factor = 0
					lifestyle_traits = 1
				}
				set_character_flag = hanami_duelist
			}
		}
		character_event = { id = japan.311 days = 1 }
	}
}

# Reveal outcome
character_event = {
	id = japan.311
	picture = GFX_evt_feast
	desc = {
		trigger = {
			has_character_flag = hanami_brave
		}
		text = EVTDESCA_JAPAN_311
	}
	desc = {
		trigger = {
			has_character_flag = hanami_not_craven
		}
		text = EVTDESCB_JAPAN_311
	}
	desc = {
		trigger = {
			has_character_flag = hanami_prestige
		}
		text = EVTDESCC_JAPAN_311
	}
	desc = {
		trigger = {
			has_character_flag = hanami_wounded
		}
		text = EVTDESCD_JAPAN_311
	}
	desc = {
		trigger = {
			has_character_flag = hanami_duelist
		}
		text = EVTDESCE_JAPAN_311
	}
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_brave
		}
		
		name = EVTOPTA_JAPAN_311 # Good!
		
		add_trait = brave
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_not_craven
		}
		
		name = EVTOPTB_JAPAN_311 # Good!
		
		remove_trait = craven
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_prestige
		}
		
		name = EVTOPTC_JAPAN_311 # Not good!
		
		prestige = -10
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_wounded
		}
		
		name = EVTOPTD_JAPAN_311 # Ow!
		
		add_trait = wounded # No Grace penalty, since we'll have to assume that some no-name guest did it...
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_duelist
		}
		
		name = EVTOPTE_JAPAN_311 # Yes!
		
		add_trait = duelist
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_duelist
		}
		
		name = EVTOPTF_JAPAN_311 # No!
		
		prestige = 25
	}
}

# Strategy discussion went well
character_event = {
	id = japan.312
	desc = EVTDESC_JAPAN_312
	picture = GFX_evt_council
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		trigger = {
			has_education_martial_trigger = yes
			NOT = {
				trait = brilliant_strategist
			}
		}
		
		name = EVTOPTA_JAPAN_312 # Good news!
		
		if = {
			limit = {
				trait = skilled_tactician
			}
			add_trait = brilliant_strategist
		}
		if = {
			limit = {
				trait = tough_soldier
			}
			add_trait = skilled_tactician
		}
		if = {
			limit = {
				trait = misguided_warrior
			}
			add_trait = tough_soldier
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTB_JAPAN_312 # This is the future!
		
		add_trait = misguided_warrior
	}
	
	option = {
		trigger = {
			OR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTC_JAPAN_312 # I'll just have the glory
		
		prestige = 25
	}
	
	
	option = {
		trigger = {
			has_education_martial_trigger = no
			NOR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTD_JAPAN_312 # Great!
		
		prestige = 25
	}
	
	option = {
		trigger = {
			trait = brilliant_strategist
		}
		
		name = EVTOPTE_JAPAN_312 # Great!
		
		prestige = 50
	}
}

# Vassal gets good event
character_event = {
	id = japan.313
	desc = EVTDESC_JAPAN_313
	picture = GFX_evt_council
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		trigger = {
			has_education_martial_trigger = yes
			NOT = {
				trait = brilliant_strategist
			}
		}
		
		name = EVTOPTA_JAPAN_313 # Good news!
		
		if = {
			limit = {
				trait = skilled_tactician
			}
			add_trait = brilliant_strategist
		}
		if = {
			limit = {
				trait = tough_soldier
			}
			add_trait = skilled_tactician
		}
		if = {
			limit = {
				trait = misguided_warrior
			}
			add_trait = tough_soldier
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTB_JAPAN_313 # This is the future!
		
		add_trait = misguided_warrior
	}
	
	option = {
		trigger = {
			OR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTC_JAPAN_313 # I'll just have the glory
		
		prestige = 25
	}
	
	
	option = {
		trigger = {
			has_education_martial_trigger = no
			NOR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTD_JAPAN_313 # Great!
		
		prestige = 25
	}
	
	option = {
		trigger = {
			trait = brilliant_strategist
		}
		
		name = EVTOPTE_JAPAN_313 # Great!
		
		prestige = 50
	}
}

# Strategy discussion went poorly
character_event = {
	id = japan.314
	desc = EVTDESC_JAPAN_314
	picture = GFX_evt_council
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_JAPAN_314 # Not good!
		
		prestige = -25
	}
}

# Strategy discussion went poorly
character_event = {
	id = japan.315
	desc = EVTDESC_JAPAN_315
	picture = GFX_evt_council
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_315 # Not good!
		
		prestige = -25
	}
}

# Go victory - liege
character_event = {
	id = japan.316
	desc = EVTDESC_JAPAN_316
	picture = GFX_evt_council
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
		event_target:hanami_go_opponent = {
			is_alive = yes
			is_inaccessible_or_incapable_trigger = no
			prisoner = no
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Way of Life"
			NOT = {
				lifestyle_traits = 1
			}
		}
		name = EVTOPTA_JAPAN_316 # Gamer!
		
		add_trait = gamer
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_316 # Prestige!
		
		prestige = 25
		
		ai_chance = {
			factor = 75
		}
	}
}

# Go loss - vassal
character_event = {
	id = japan.317
	desc = EVTDESC_JAPAN_317
	picture = GFX_evt_council
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_317 # Not good!
		
		prestige = -10
	}
}

# Go loss - liege
character_event = {
	id = japan.318
	desc = EVTDESC_JAPAN_318
	picture = GFX_evt_council
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
		event_target:hanami_go_opponent = {
			is_alive = yes
			is_inaccessible_or_incapable_trigger = no
			prisoner = no
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_318 # Not good!
		
		prestige = -10
	}
}

# Go victory - vassal
character_event = {
	id = japan.319
	desc = EVTDESC_JAPAN_319
	picture = GFX_evt_council
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Way of Life"
			NOT = {
				lifestyle_traits = 1
			}
		}
		name = EVTOPTA_JAPAN_319 # Gamer!
		
		add_trait = gamer
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_319 # Prestige!
		
		prestige = 25
		
		ai_chance = {
			factor = 75
		}
	}
}

##### Liege pings to set up secondary events (320-321)

# Event setting up the second group of hanami events
character_event = {
	id = japan.320
	hide_window = yes
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			### Event group 2 - 10-19 days into the hanami (176-226)
			
			# Daytime events 1
			if = {
				limit = {
					has_character_flag = daytime_hanami
				}
				random_list = {
					20 = {
						set_character_flag = hanami_good_weather
						character_event = { id = japan.176 } # Beautiful weather
					}
					20 = {
						modifier = {
							factor = 0
							NOT = {
								any_vassal = {
									count = 2
									has_character_flag = going_to_hanami
									NOR = {
										any_friend = {
											character = ROOT
										}
										any_rival = {
											character = ROOT
										}
										any_lover = {
											character = ROOT
										}
									}
								}
							}
						}
						# Vassal makes a friend/rival
						random_list = {
							50 = {
								random_vassal = {
									limit = {
										has_character_flag = coming_to_hanami
									}
									save_event_target_as = hanami_friend_1
								}
								random_vassal = {
									limit = {
										has_character_flag = coming_to_hanami
										NOR = {
											any_friend = {
												character = PREV
											}
											any_rival = {
												character = PREV
											}
											any_lover = {
												character = PREV
											}
											NOT = {
												event_target:hanami_friend_1 = {
													character = PREV
												}
											}
										}
									}
									save_event_target_as = hanami_friend_2
								}
								event_target:hanami_friend_1 = {
									character_event = { id = japan.177 } # Ping the vassal - friend
								}
							}
							50 = {
								random_vassal = {
									limit = {
										has_character_flag = coming_to_hanami
									}
									save_event_target_as = hanami_rival_1
								}
								random_vassal = {
									limit = {
										has_character_flag = coming_to_hanami
										NOR = {
											any_friend = {
												character = PREV
											}
											any_rival = {
												character = PREV
											}
											any_lover = {
												character = PREV
											}
											NOT = {
												event_target:hanami_rival_1 = {
													character = PREV
												}
											}
										}
									}
									save_event_target_as = hanami_rival_2
								}
								event_target:hanami_rival_1 = {
									character_event = { id = japan.180 } # Ping the vassal - rival
								}
							}
						}
					}
					20 = {
						modifier = {
							factor = 0
							NOT = {
								any_vassal = {
									count = 2
									is_adult = yes
									has_character_flag = coming_to_hanami
									NOT = {
										num_of_rivals = 1
									}
								}
							}
						}
						# Arguing vassals
						random_vassal = {
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
								NOT = {
									num_of_rivals = 1
								}
							}
							save_event_target_as = arguing_hanami_vassal_1
						}
						random_vassal = {
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
								NOT = {
									num_of_rivals = 1
								}
								NOT = {
									event_target:arguing_hanami_vassal_1 = {
										character = PREV
									}
								}
							}
							save_event_target_as = arguing_hanami_vassal_2
						}
						character_event = { id = japan.183 } # Inform the liege
					}
					20 = {
						character_event = { id = japan.188 } # A visiting priest(ess)
					}
					20 = {}
				}
			}
			
			# Nighttime events 1
			if = {
				limit = {
					has_character_flag = nighttime_hanami
				}
				random_list = {
					20 = {
						# Love in the Dark
						random_vassal = {
							limit = {
								has_character_flag = coming_to_hanami
							}
							random_list = {
								25 = {
									modifier = {
										factor = 0
										is_adult = no
									}
									modifier = {
										factor = 0
										OR = {
											trait = chaste
											trait = celibate
											has_lover = yes
										}
									}
									save_event_target_as = hanami_lover_1
									ROOT = {
										random_vassal = {
											limit = {
												has_character_flag = coming_to_hanami
												NOT = {
													event_target:hanami_lover_1 = {
														NOT = {
															character = PREV
														}
													}
												}
											}
											random_list = {
												25 = {
													modifier = {
														factor = 0
														is_adult = no
													}
													modifier = {
														factor = 0
														OR = {
															trait = chaste
															trait = celibate
															has_lover = yes
														}
													}
													modifier = {
														factor = 0
														OR = {
															AND = {
																is_female = no
																event_target:hanami_lover_1 = {
																	prefers_men_trigger = no
																}
															}
															AND = {
																is_female = yes
																event_target:hanami_lover_1 = {
																	prefers_men_trigger = yes
																}
															}
														}
													}
													modifier = {
														factor = 0
														OR = {
															AND = {
																prefers_men_trigger = no
																event_target:hanami_lover_1 = {
																	is_female = no
																}
															}
															AND = {
																prefers_men_trigger = yes
																event_target:hanami_lover_1 = {
																	is_female = yes
																}
															}
														}
													}
													save_event_target_as = hanami_lover_2
												}
												75 = {
													random_courtier = {
														limit = {
															is_adult = yes
															is_inaccessible_or_incapable_trigger  = no
															prisoner = no
															has_lover = no
															NOR = {
																trait = chaste
																trait = celibate
																has_lover = yes
															}
															OR = {
																AND = {
																	is_female = yes
																	event_target:hanami_lover_1 = {
																		prefers_men_trigger = no
																	}
																}
																AND = {
																	is_female = no
																	event_target:hanami_lover_1 = {
																		prefers_men_trigger = yes
																	}
																}
															}
															OR = {
																AND = {
																	is_female = yes
																	event_target:hanami_lover_1 = {
																		prefers_men_trigger = no
																	}
																}
																AND = {
																	is_female = no
																	event_target:hanami_lover_1 = {
																		prefers_men_trigger = yes
																	}
																}
															}
														}
														save_event_target_as = hanami_lover_2
													}
												}
											}
										}
									}
								}
								75 = {
									random_courtier = {
										limit = {
											is_adult = yes
											is_inaccessible_or_incapable_trigger  = no
											prisoner = no
											has_lover = no
											NOR = {
												trait = chaste
												trait = celibate
												has_lover = yes
											}
										}
										save_event_target_as = hanami_lover_1
										ROOT = {
											random_vassal = {
												limit = {
													has_character_flag = coming_to_hanami
													NOT = {
														event_target:hanami_lover_1 = {
															NOT = {
																character = PREV
															}
														}
													}
												}
												random_list = {
													25 = {
														modifier = {
															factor = 0
															is_adult = no
														}
														modifier = {
															factor = 0
															OR = {
																trait = chaste
																trait = celibate
																has_lover = yes
															}
														}
														modifier = {
															factor = 0
															OR = {
																AND = {
																	is_female = no
																	event_target:hanami_lover_1 = {
																		prefers_men_trigger = no
																	}
																}
																AND = {
																	is_female = yes
																	event_target:hanami_lover_1 = {
																		prefers_men_trigger = yes
																	}
																}
															}
														}
														modifier = {
															factor = 0
															OR = {
																AND = {
																	prefers_men_trigger = no
																	event_target:hanami_lover_1 = {
																		is_female = no
																	}
																}
																AND = {
																	prefers_men_trigger = yes
																	event_target:hanami_lover_1 = {
																		is_female = yes
																	}
																}
															}
														}
														save_event_target_as = hanami_lover_2
													}
													75 = {
														random_courtier = {
															limit = {
																is_adult = yes
																is_inaccessible_or_incapable_trigger  = no
																prisoner = no
																has_lover = no
																NOR = {
																	trait = chaste
																	trait = celibate
																	has_lover = yes
																}
																OR = {
																	AND = {
																		is_female = yes
																		event_target:hanami_lover_1 = {
																			prefers_men_trigger = no
																		}
																	}
																	AND = {
																		is_female = no
																		event_target:hanami_lover_1 = {
																			prefers_men_trigger = yes
																		}
																	}
																}
																OR = {
																	AND = {
																		is_female = yes
																		event_target:hanami_lover_1 = {
																			prefers_men_trigger = no
																		}
																	}
																	AND = {
																		is_female = no
																		event_target:hanami_lover_1 = {
																			prefers_men_trigger = yes
																		}
																	}
																}
															}
															save_event_target_as = hanami_lover_2
														}
													}
												}
											}
										}
									}
								}
							}
						}
						event_target:hanami_lover_1 = {
							character_event = { id = japan.189 } # Let the first potential lover choose whether to approach the second
						}
					}
					20 = {
						character_event = { id = japan.203 } # Noise complaints
					}
					20 = {
						character_event = { id = japan.204 } # A shadowy figure
					}
					20 = {
						random_vassal = {
							limit = {
								has_character_flag = coming_to_hanami
							}
							save_event_target_as = sleeping_hanami_vassal
						}
						character_event = { id = japan.205 } # Vassal falls asleep
					}
					20 = {}
				}
			}
			
			# Misc events 1
			random_list = {
				25 = {
					character_event = { id = japan.210 days = 3 random = 3 } # Sake
				}
				25 = {
					random_vassal = {
						limit = {
							has_character_flag = coming_to_hanami
						}
						save_event_target_as = hanami_poetry_vassal
					}
					event_target:hanami_poetry_vassal = {
						character_event = { id = japan.211 days = 3 random = 3 } # Poetry contest
					}
				}
				25 = {
					modifier = {
						factor = 0
						NOT = {
							any_vassal = {
								count = 2
								is_adult = yes
								has_character_flag = coming_to_hanami
								OR = {
									is_female = no
									ROOT = {
										primary_title = {
											has_law = status_of_women_3
										}
									}
								}
								ROOT = {
									any_vassal = {
										is_adult = yes
										has_character_flag = coming_to_hanami
										OR = {
											is_female = no
											ROOT = {
												primary_title = {
													has_law = status_of_women_3
												}
											}
										}
										NOT = {
											character = PREVPREV
										}
										NOR = {
											reverse_opinion = {
												who = PREVPREV
												value = 0
											}
											opinion = {
												who = PREVPREV
												value = 0
											}
										}
									}
								}
							}
						}
					}
					random_vassal = {
						limit = {
							is_adult = yes
							has_character_flag = coming_to_hanami
							OR = {
								is_female = no
								ROOT = {
									primary_title = {
										has_law = status_of_women_3
									}
								}
							}
							ROOT = {
								any_vassal = {
									is_adult = yes
									has_character_flag = coming_to_hanami
									OR = {
										is_female = no
										ROOT = {
											primary_title = {
												has_law = status_of_women_3
											}
										}
									}
									NOT = {
										character = PREVPREV
									}
									NOR = {
										reverse_opinion = {
											who = PREVPREV
											value = 0
										}
										opinion = {
											who = PREVPREV
											value = 0
										}
									}
								}
							}
						}
						save_event_target_as = hanami_duel_vassal_1
					}
					random_vassal = {
						limit = {
							is_adult = yes
							has_character_flag = coming_to_hanami
							OR = {
								is_female = no
								ROOT = {
									primary_title = {
										has_law = status_of_women_3
									}
								}
							}
							ROOT = {
								event_target:hanami_duel_vassal_1 = {
									NOT = {
										character = PREVPREV
									}
									NOR = {
										reverse_opinion = {
											who = PREVPREV
											value = 0
										}
										opinion = {
											who = PREVPREV
											value = 0
										}
									}
								}
							}
						}
						save_event_target_as = hanami_duel_vassal_2
					}
					event_target:hanami_duel_vassal_1 = {
						character_event = { id = japan.217 days = 3 random = 3 } # Duel between vassals
					}
				}
				25 = {}
			}
			
			# Food complaints/compliments - based on vanilla
			random_list = {
				10 = { #Lavish food (vassal)
					modifier = {
						factor = 0
						NOR = {
							has_character_flag = lavishly_food
							any_vassal = {
								has_character_flag = coming_to_hanami
								war = no
							}
						}
					}
					random_vassal = {
						limit = { 
							has_character_flag = coming_to_hanami
							war = no
						}
						character_event = { id = japan.223 days = 6 random = 3 }
					}
				}
				10 = { #Medium food (vassal)
					modifier = {
						factor = 0
						NOR = {
							has_character_flag = medium_food
							any_vassal = {
								has_character_flag = coming_to_hanami
								war = no
							}
						}
					}
					random_vassal = {
						limit = { 
							has_character_flag = coming_to_hanami
							war = no
						}
						character_event = { id = japan.224 days = 6 random = 3 }
					}
				}
				10 = { #Low food (vassal)
					modifier = {
						factor = 0
						NOR = {
							has_character_flag = low_food
							any_vassal = {
								has_character_flag = coming_to_hanami
								war = no
							}
						}
					}
					random_vassal = {
						limit = { 
							has_character_flag = coming_to_hanami
							war = no
						}
						character_event = { id = japan.225 days = 6 random = 3 }
					}
				}
			}
			
			character_event = { id = japan.321 days = 10 } # Third group of events
		}
	}
}

# Event setting up the third group of hanami events
character_event = {
	id = japan.321
	hide_window = yes
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			### Event group 3 - 20-29 days into the hanami (228-318)
			
			# Entertainment 2 - guaranteed if a remarkable or troublesome entertainer is present, otherwise minor flavour can happen from time to time
			
			if = {
				limit = {
					OR = {
						has_character_flag = troublesome_shirabyoshi
						has_character_flag = remarkable_shirabyoshi
					}
					NOT = {
						has_character_flag = banished_shirabyoshi
						has_character_flag = shirabyoshi_killed
					}
				}
				if = {
					limit = {
						has_character_flag = troublesome_shirabyoshi
						event_target:troublesome_shirabyoshi = {
							is_alive = yes
						}
					}
					random_list = {
						50 = {
							# Shirabyoshi and duelling vassal might become lovers/friends
							event_target:troublesome_shirabyoshi = {
								any_opinion_modifier_target = {
									limit = {
										OR = {
											reverse_has_opinion_modifier = {
												who = PREV
												modifier = hanami_duel_good_sport
											}
											reverse_has_opinion_modifier = {
												who = PREV
												modifier = hanami_duel_bad_sport # You can certainly try, but good luck!
											}
										}
									}
									character_event = { id = japan.228 } # Vassal gets event
								}
							}
						}
						100 = {
							# Angry shirabyoshi attempts to kill vassal
							modifier = {
								factor = 0
								event_target:troublesome_shirabyoshi = {
									NOT = {
										has_any_opinion_modifier = hanami_duel_bad_sport
									}
								}
							}
							# Shirabyoshi and duelling vassal might become lovers/friends
							event_target:troublesome_shirabyoshi = {
								character_event = { id = japan.235 } # Shirabyoshi gets event
							}
						}
						100 = {
							# Angry vassal attempts to kill shirabyoshi
							modifier = {
								factor = 0
								event_target:troublesome_shirabyoshi = {
									NOT = {
										has_any_opinion_modifier = hanami_duel_bad_sport
									}
								}
							}
							event_target:troublesome_shirabyoshi = {
								any_opinion_modifier_target = {
									limit = {
										reverse_has_opinion_modifier = {
											who = PREV
											modifier = hanami_duel_bad_sport
										}
										NOT = {
											has_character_flag = won_shirabyoshi_duel
										}
									}
									character_event = { id = japan.249 } # Vassal gets event
								}
							}
						}
						50 = {
							# Shirabyoshi teaches female courtier how to fight
							modifier = {
								factor = 0
								NOT = {
									any_courtier = {
										is_adult = yes
										dynasty = ROOT
										is_female = yes
										is_inaccessible_or_incapable_trigger = no
										prisoner = no
										NOT = {
											lifestyle_traits = 1
										}
										NOT = {
											has_character_flag = shirabyoshi_lesson
										}
										event_target:troublesome_shirabyoshi = {
											NOT = {
												has_opinion_modifier = {
													who = PREV
													modifier = hanami_duel_bad_sport
												}
											}
										}
									}
								}
							}
							random_courtier = {
								limit = {
									is_adult = yes
									dynasty = ROOT
									is_female = yes
									is_inaccessible_or_incapable_trigger = no
									prisoner = no
									NOT = {
										lifestyle_traits = 1
									}
									NOT = {
										has_character_flag = shirabyoshi_lesson
									}
									event_target:troublesome_shirabyoshi = {
										NOT = {
											has_opinion_modifier = {
												who = PREV
												modifier = hanami_duel_bad_sport
											}
										}
									}
								}
								set_character_flag = shirabyoshi_lesson
								character_event = { id = japan.261 } # Female relative gets lesson
							}
						}
					}
				}
				if = {
					limit = {
						has_character_flag = remarkable_shirabyoshi
						event_target:remarkable_shirabyoshi = {
							is_alive = yes
						}
					}
					random_list = {
						50 = {
							# Try to seduce/befriend shirabyoshi?
							character_event = { id = japan.263 }
						}
						45 = {
							# Shirabyoshi provides vassal opinion boost
							character_event = { id = japan.270 }
						}
						5 = {
							# Appoint shirabyoshi commander?
							character_event = { id = japan.272 }
						}
					}
				}
			}
			
			if = {
				limit = {
					has_character_flag = hanami_shirabyoshi
					NOR = {
						has_character_flag = troublesome_shirabyoshi
						has_character_flag = remarkable_shirabyoshi
						has_character_flag = shirabyoshi_noshow
						has_character_flag = bad_shirabyoshi
					}
				}
				random_list = {
					25 = {
						# Shirabyoshi perform well
						character_event = { id = japan.274 }
					}
					25 = {
						# Shirabyoshi upset someone
						random_vassal = {
							limit = {
								has_character_flag = going_to_hanami
							}
							character_event = { id = japan.276 }
						}
					}
					50 = {}
				}
			}
			
			# Daytime events 2
			if = {
				limit = {
					has_character_flag = daytime_hanami
				}
				random_list = {
					50 = {
						# Children become friends/rivals
						random_child = {
							limit = {
								age = 6
								NOT = {
									age = 16
								}
							}
							ROOT = {
								random_vassal = {
									limit = {
										has_character_flag = coming_to_hanami
									}
									random_child = {
										limit = {
											age = 6
											NOT = {
												age = 16
											}
											NOR = {
												any_friend = {
													character = PREVPREVPREV
												}
												any_rival = {
													character = PREVPREVPREV
												}
											}
										}
										save_event_target_as = hanami_child_friend_rival
									}
									random_list = {
										50 = {
											character_event = { id = japan.280 days = 3 random = 3 } # Friends?
										}
										50 = {
											character_event = { id = japan.284 days = 3 random = 3 } # Rivals?
										}
									}
								}
							}
						}
					}
					40 = {
						character_event = { id = japan.288 days = 3 random = 3 } # The weather worsens
					}
					10 = {}
				}
			}
			
			# Nighttime events 2
			if = {
				limit = {
					has_character_flag = nighttime_hanami
				}
				random_list = {
					50 = {
						character_event = { id = japan.289 days = 3 random = 3 } # Fireworks merchant
					}
					40 = {
						random_list = {
							1 = {
								character_event = { id = japan.305 days = 3 random = 3 } # Comet sighted!
							}
							#10 = {
							#	character_event = { id = japan.306 days = 3 random = 3 } # Scholar/prestige
							#}
							20 = {
								modifier = {
									factor = 0
									is_married = no
								}
								modifier = {
									factor = 0
									spouse = {
										OR = {
											is_inaccessible_or_incapable_trigger = yes
											prisoner = yes
										}
									}
								}
								modifier = {
									factor = 0
									spouse = {
										num_of_lovers = 1
									}
								}
								modifier = {
									factor = 0
									spouse = {
										NOT = {
											opinion = {
												who = ROOT
												value = 25
											}
										}
									}
								}
								modifier = {
									factor = 0
									spouse = {
										NOT = {
											root_attraction_trigger = yes
										}
										NOT = {
											attacted_to_root_trigger = yes # Vanilla trigger typo
										}
									}
								}
								character_event = { id = japan.307 days = 3 random = 3 } # Bond with spouse
							}
							20 = {
								modifier = {
									factor = 0
									NOT = {
										any_child = {
											prisoner = no
											is_inaccessible_or_incapable_trigger = no
											host = {
												character = ROOT
											}
											NOR = {
												any_friend = {
													character = ROOT
												}
												any_rival = {
													character = ROOT
												}
											}
											opinion = {
												who = ROOT
												value = 0
											}
										}
									}
								}
								character_event = { id = japan.308 days = 3 random = 3 } # Bond with child
							}
							59 = {
								character_event = { id = japan.309 days = 3 random = 3 } # Just a nice evening
							}
						}
						# Stargazing
					}
					10 = {}
				}
			}
			
			# Misc events 2
			random_list = {
				25 = {
					character_event = { id = japan.310 days = 6 random = 3 } # Sword practice
					if = {
						limit = {
							tier = duke
						}
						random_vassal = {
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
							}
							character_event = { id = japan.310 days = 6 random = 3 } # Sword practice
						}
					}
					if = {
						limit = {
							tier = king
						}
						any_vassal = {
							count = 2
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
							}
							character_event = { id = japan.310 days = 6 random = 3 } # Sword practice
						}
					}
					if = {
						limit = {
							tier = emperor
						}
						any_vassal = {
							count = 5
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
							}
							character_event = { id = japan.310 days = 6 random = 3 } # Sword practice
						}
					}
				}
				25 = {
					# Strategy discussion
					modifier = {
						factor = 0
						NOT = {
							any_vassal = {
								has_character_flag = coming_to_hanami
								is_adult = yes
							}
						}
					}
					random_list = {
						50 = {
							modifier = {
								factor = 10
								trait = brilliant_strategist
							}
							modifier = {
								factor = 5
								trait = skilled_tactician
							}
							modifier = {
								factor = 2
								martial = 32
							}
							modifier = {
								factor = 2
								martial = 28
							}
							modifier = {
								factor = 2
								martial = 24
							}
							modifier = {
								factor = 2
								martial = 20
							}
							modifier = {
								factor = 2
								martial = 16
							}
							character_event = { id = japan.312 days = 6 random = 3 }
						}
						50 = {
							modifier = {
								factor = 2
								NOT = {
									martial = 12
								}
							}
							modifier = {
								factor = 2
								NOT = {
									martial = 8
								}
							}
							modifier = {
								factor = 2
								NOT = {
									martial = 4
								}
							}
							modifier = {
								factor = 2
								NOR = {
									trait = brilliant_strategist
									trait = skilled_tactician
								}
							}
							modifier = {
								factor = 2
								NOR = {
									trait = brilliant_strategist
									trait = skilled_tactician
									trait = tough_soldier
									trait = misguided_warrior
								}
							}
							character_event = { id = japan.314 days = 6 random = 3 }
						}
					}
					if = {
						limit = {
							tier = duke
						}
						random_vassal = {
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
							}
							random_list = {
								50 = {
									modifier = {
										factor = 10
										trait = brilliant_strategist
									}
									modifier = {
										factor = 5
										trait = skilled_tactician
									}
									modifier = {
										factor = 2
										martial = 32
									}
									modifier = {
										factor = 2
										martial = 28
									}
									modifier = {
										factor = 2
										martial = 24
									}
									modifier = {
										factor = 2
										martial = 20
									}
									modifier = {
										factor = 2
										martial = 16
									}
									character_event = { id = japan.313 days = 6 random = 3 }
								}
								50 = {
									modifier = {
										factor = 2
										NOT = {
											martial = 12
										}
									}
									modifier = {
										factor = 2
										NOT = {
											martial = 8
										}
									}
									modifier = {
										factor = 2
										NOT = {
											martial = 4
										}
									}
									modifier = {
										factor = 2
										NOR = {
											trait = brilliant_strategist
											trait = skilled_tactician
										}
									}
									modifier = {
										factor = 2
										NOR = {
											trait = brilliant_strategist
											trait = skilled_tactician
											trait = tough_soldier
											trait = misguided_warrior
										}
									}
									character_event = { id = japan.315 days = 6 random = 3 }
								}
							}
						}
					}
					if = {
						limit = {
							tier = king
						}
						any_vassal = {
							count = 2
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
							}
							random_list = {
								50 = {
									modifier = {
										factor = 10
										trait = brilliant_strategist
									}
									modifier = {
										factor = 5
										trait = skilled_tactician
									}
									modifier = {
										factor = 2
										martial = 32
									}
									modifier = {
										factor = 2
										martial = 28
									}
									modifier = {
										factor = 2
										martial = 24
									}
									modifier = {
										factor = 2
										martial = 20
									}
									modifier = {
										factor = 2
										martial = 16
									}
									character_event = { id = japan.313 days = 6 random = 3 }
								}
								50 = {
									modifier = {
										factor = 2
										NOT = {
											martial = 12
										}
									}
									modifier = {
										factor = 2
										NOT = {
											martial = 8
										}
									}
									modifier = {
										factor = 2
										NOT = {
											martial = 4
										}
									}
									modifier = {
										factor = 2
										NOR = {
											trait = brilliant_strategist
											trait = skilled_tactician
										}
									}
									modifier = {
										factor = 2
										NOR = {
											trait = brilliant_strategist
											trait = skilled_tactician
											trait = tough_soldier
											trait = misguided_warrior
										}
									}
									character_event = { id = japan.315 days = 6 random = 3 }
								}
							}
						}
					}
					if = {
						limit = {
							tier = emperor
						}
						any_vassal = {
							count = 5
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
							}
							random_list = {
								50 = {
									modifier = {
										factor = 10
										trait = brilliant_strategist
									}
									modifier = {
										factor = 5
										trait = skilled_tactician
									}
									modifier = {
										factor = 2
										martial = 32
									}
									modifier = {
										factor = 2
										martial = 28
									}
									modifier = {
										factor = 2
										martial = 24
									}
									modifier = {
										factor = 2
										martial = 20
									}
									modifier = {
										factor = 2
										martial = 16
									}
									character_event = { id = japan.313 days = 6 random = 3 }
								}
								50 = {
									modifier = {
										factor = 2
										NOT = {
											martial = 12
										}
									}
									modifier = {
										factor = 2
										NOT = {
											martial = 8
										}
									}
									modifier = {
										factor = 2
										NOT = {
											martial = 4
										}
									}
									modifier = {
										factor = 2
										NOR = {
											trait = brilliant_strategist
											trait = skilled_tactician
										}
									}
									modifier = {
										factor = 2
										NOR = {
											trait = brilliant_strategist
											trait = skilled_tactician
											trait = tough_soldier
											trait = misguided_warrior
										}
									}
									character_event = { id = japan.315 days = 6 random = 3 }
								}
							}
						}
					}
				}
				25 = {
					# Go
					random_vassal = {
						limit = {
							has_character_flag = coming_to_hanami
						}
						save_event_target_as = hanami_go_opponent
					}
					random_list = {
						50 = {
							modifier = {
								factor = 10
								trait = gamer
								event_target:hanami_go_opponent = {
									NOT = {
										trait = gamer
									}
								}
							}
							modifier = {
								factor = 2
								learning = 32
							}
							modifier = {
								factor = 2
								learning = 28
							}
							modifier = {
								factor = 2
								learning = 24
							}
							modifier = {
								factor = 2
								learning = 20
							}
							modifier = {
								factor = 2
								learning = 16
							}
							modifier = {
								factor = 0.5
								event_target:hanami_go_opponent = {
									learning = 32
								}
							}
							modifier = {
								factor = 2
								event_target:hanami_go_opponent = {
									learning = 28
								}
							}
							modifier = {
								factor = 2
								event_target:hanami_go_opponent = {
									learning = 24
								}
							}
							modifier = {
								factor = 2
								event_target:hanami_go_opponent = {
									learning = 20
								}
							}
							modifier = {
								factor = 2
								event_target:hanami_go_opponent = {
									learning = 16
								}
							}
							character_event = { id = japan.316 days = 6 random = 3 } # Go victory
							event_target:hanami_go_opponent = {
								character_event = { id = japan.317 days = 6 random = 3 } # Go defeat
							}
						}
						50 = {
							modifier = {
								factor = 10
								NOT = {
									trait = gamer
								}
								event_target:hanami_go_opponent = {
									trait = gamer
								}
							}
							modifier = {
								factor = 2
								NOT = {
									learning = 12
								}
							}
							modifier = {
								factor = 2
								NOT = {
									learning = 8
								}
							}
							modifier = {
								factor = 2
								NOT = {
									learning = 4
								}
							}
							modifier = {
								factor = 0.5
								event_target:hanami_go_opponent = {
									NOT = {
										learning = 12
									}
								}
							}
							modifier = {
								factor = 0.5
								event_target:hanami_go_opponent = {
									NOT = {
										learning = 8
									}
								}
							}
							modifier = {
								factor = 0.5
								event_target:hanami_go_opponent = {
									NOT = {
										learning = 4
									}
								}
							}
							character_event = { id = japan.318 days = 6 random = 3 } # Go defeat
							event_target:hanami_go_opponent = {
								character_event = { id = japan.319 days = 6 random = 3 } # Go victory
							}
						}
					}
				}
				25 = {}
			}
		}
	}
}

##### End of hanami events (322-325)

# The hanami has ended
character_event = {
	id = japan.322
	desc = EVTDESC_JAPAN_322
	picture = GFX_evt_feast

	capable_only = yes
	prisoner = no

	is_triggered_only = yes

	trigger = {
		has_character_modifier = hanami_in_progress
	}

	option = {
		name = EVTOPTA_JAPAN_322 # That was fun!
		prestige = 10
		set_character_flag = recent_hanami
		
		hidden_tooltip = {
			remove_character_modifier = hanami_in_progress
			clr_character_flag = sakura_hanami
			clr_character_flag = daytime_hanami
			clr_character_flag = nighttime_hanami
			clr_character_flag = hanami_decorate_capital_event
			clr_character_flag = hanami_capital_decorated
			clr_character_flag = hanami_capital_extremely_decorated
			clr_character_flag = hanami_plain_capital
			clr_character_flag = hanami_offerings_event
			clr_character_flag = hanami_small_offering
			clr_character_flag = hanami_great_offering
			clr_character_flag = hanami_dw_self_sabotage
			clr_character_flag = hanami_dw_sabotage_attempted
			clr_character_flag = hanami_no_offering
			clr_character_flag = hanami_improve_garden_event
			clr_character_flag = hanami_garden_improvement_self
			clr_character_flag = hanami_garden_improvement
			clr_character_flag = hanami_garden_improvement_self_gardener
			clr_character_flag = hanami_weeds
			clr_character_flag = hanami_shirabyoshi_event
			clr_character_flag = hanami_shirabyoshi
			clr_character_flag = hanami_no_entertainers
			clr_character_flag = lavishly_food
			clr_character_flag = medium_food
			clr_character_flag = low_food
			clr_character_flag = sent_invitations
			clr_character_flag = shirabyoshi_noshow
			clr_character_flag = bad_shirabyoshi
			clr_character_flag = inspiring_shirabyoshi
			clr_character_flag = troublesome_shirabyoshi
			clr_character_flag = remarkable_shirabyoshi
			clr_character_flag = banished_shirabyoshi
			clr_character_flag = shirabyoshi_killed
			clr_character_flag = hanami_duel_challengee_won
			clr_character_flag = hanami_duel_draw
			clr_character_flag = hanami_duel_challenger_won
			clr_character_flag = hanami_in_progress
			clr_character_flag = hanami_good_weather
			clr_character_flag = hanami_shirabyoshi_duel_hold_back
			clr_character_flag = hanami_shirabyoshi_duel_fair_fight
			clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
			clr_character_flag = hanami_brave
			clr_character_flag = hanami_not_craven
			clr_character_flag = hanami_prestige
			clr_character_flag = hanami_wounded
			clr_character_flag = hanami_duelist
			clr_character_flag = do_not_disturb
			clr_character_flag = won_shirabyoshi_duel
			any_vassal = {
				limit = {
					has_character_flag = guest_hanami_started
				}
				character_event = { id = japan.323 }
				remove_opinion = {
					modifier = opinion_enjoyed_hanami
					who = ROOT
				}
				opinion = {
					modifier = opinion_enjoyed_hanami
					who = ROOT
					years = 2
				}
				clr_character_flag = coming_to_hanami
				clr_character_flag = guest_hanami_started
				clr_character_flag = hanami_shirabyoshi_duel_hold_back
				clr_character_flag = hanami_shirabyoshi_duel_fair_fight
				clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
				clr_character_flag = hanami_brave
				clr_character_flag = hanami_not_craven
				clr_character_flag = hanami_prestige
				clr_character_flag = hanami_wounded
				clr_character_flag = hanami_duelist
				clr_character_flag = shirabyoshi_dueller
				clr_character_flag = won_shirabyoshi_duel
			}
			any_courtier = {
				clr_character_flag = coming_to_hanami
				clr_character_flag = guest_hanami_started
				clr_character_flag = hanami_shirabyoshi_duel_hold_back
				clr_character_flag = hanami_shirabyoshi_duel_fair_fight
				clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
				clr_character_flag = hanami_brave
				clr_character_flag = hanami_not_craven
				clr_character_flag = hanami_prestige
				clr_character_flag = hanami_wounded
				clr_character_flag = hanami_duelist
				clr_character_flag = shirabyoshi_dueller
				clr_character_flag = won_shirabyoshi_duel
			}
		}
	}
}

# Vassal: Hanami ended
character_event = {
	id = japan.323
	desc = EVTDESC_JAPAN_323
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_JAPAN_323 # That was fun!
		prestige = 5
	}
}

# The hanami is cancelled
character_event = {
	id = japan.324
	desc = EVTDESC_JAPAN_324
	picture = GFX_evt_burning_house

	only_rulers = yes
	war = yes

	trigger = {
		has_character_modifier = holding_large_feast
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = EVTOPTA_JAPAN_324 # I see...
		
		hidden_tooltip = {
			remove_character_modifier = hanami_in_progress
			clr_character_flag = sakura_hanami
			clr_character_flag = daytime_hanami
			clr_character_flag = nighttime_hanami
			clr_character_flag = hanami_decorate_capital_event
			clr_character_flag = hanami_capital_decorated
			clr_character_flag = hanami_capital_extremely_decorated
			clr_character_flag = hanami_plain_capital
			clr_character_flag = hanami_offerings_event
			clr_character_flag = hanami_small_offering
			clr_character_flag = hanami_great_offering
			clr_character_flag = hanami_dw_self_sabotage
			clr_character_flag = hanami_dw_sabotage_attempted
			clr_character_flag = hanami_no_offering
			clr_character_flag = hanami_improve_garden_event
			clr_character_flag = hanami_garden_improvement_self
			clr_character_flag = hanami_garden_improvement
			clr_character_flag = hanami_garden_improvement_self_gardener
			clr_character_flag = hanami_weeds
			clr_character_flag = hanami_shirabyoshi_event
			clr_character_flag = hanami_shirabyoshi
			clr_character_flag = hanami_no_entertainers
			clr_character_flag = lavishly_food
			clr_character_flag = medium_food
			clr_character_flag = low_food
			clr_character_flag = sent_invitations
			clr_character_flag = shirabyoshi_noshow
			clr_character_flag = bad_shirabyoshi
			clr_character_flag = inspiring_shirabyoshi
			clr_character_flag = troublesome_shirabyoshi
			clr_character_flag = remarkable_shirabyoshi
			clr_character_flag = banished_shirabyoshi
			clr_character_flag = shirabyoshi_killed
			clr_character_flag = hanami_duel_challengee_won
			clr_character_flag = hanami_duel_draw
			clr_character_flag = hanami_duel_challenger_won
			clr_character_flag = hanami_in_progress
			clr_character_flag = hanami_good_weather
			clr_character_flag = hanami_shirabyoshi_duel_hold_back
			clr_character_flag = hanami_shirabyoshi_duel_fair_fight
			clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
			clr_character_flag = hanami_brave
			clr_character_flag = hanami_not_craven
			clr_character_flag = hanami_prestige
			clr_character_flag = hanami_wounded
			clr_character_flag = hanami_duelist
			clr_character_flag = do_not_disturb
			clr_character_flag = won_shirabyoshi_duel
			any_vassal = {
				limit = {
					has_character_flag = guest_hanami_started
				}
				letter_event = { id = japan.325 }
				remove_opinion = {
					modifier = opinion_enjoyed_hanami
					who = ROOT
				}
				opinion = {
					modifier = opinion_enjoyed_hanami
					who = ROOT
					years = 2
				}
				clr_character_flag = coming_to_hanami
				clr_character_flag = guest_hanami_started
				clr_character_flag = hanami_shirabyoshi_duel_hold_back
				clr_character_flag = hanami_shirabyoshi_duel_fair_fight
				clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
				clr_character_flag = hanami_brave
				clr_character_flag = hanami_not_craven
				clr_character_flag = hanami_prestige
				clr_character_flag = hanami_wounded
				clr_character_flag = hanami_duelist
				clr_character_flag = shirabyoshi_dueller
				clr_character_flag = won_shirabyoshi_duel
			}
			any_courtier = {
				clr_character_flag = coming_to_hanami
				clr_character_flag = guest_hanami_started
				clr_character_flag = hanami_shirabyoshi_duel_hold_back
				clr_character_flag = hanami_shirabyoshi_duel_fair_fight
				clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
				clr_character_flag = hanami_brave
				clr_character_flag = hanami_not_craven
				clr_character_flag = hanami_prestige
				clr_character_flag = hanami_wounded
				clr_character_flag = hanami_duelist
				clr_character_flag = shirabyoshi_dueller
				clr_character_flag = won_shirabyoshi_duel
			}
		}
	}
}

# Hanami cancelled: notify invited vassals
letter_event = {
	id = japan.325
	desc = EVTDESC_JAPAN_325

	is_triggered_only = yes

	option = {
		name = EVTOPTA_JAPAN_325 # I see...
	}
}

##### Flag cleanup (326)

# Cleanup event
character_event = {
	id = japan.326

	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		remove_character_modifier = hanami_in_progress
		clr_character_flag = sakura_hanami
		clr_character_flag = daytime_hanami
		clr_character_flag = nighttime_hanami
		clr_character_flag = hanami_decorate_capital_event
		clr_character_flag = hanami_capital_decorated
		clr_character_flag = hanami_capital_extremely_decorated
		clr_character_flag = hanami_plain_capital
		clr_character_flag = hanami_offerings_event
		clr_character_flag = hanami_small_offering
		clr_character_flag = hanami_great_offering
		clr_character_flag = hanami_dw_self_sabotage
		clr_character_flag = hanami_dw_sabotage_attempted
		clr_character_flag = hanami_no_offering
		clr_character_flag = hanami_improve_garden_event
		clr_character_flag = hanami_garden_improvement_self
		clr_character_flag = hanami_garden_improvement
		clr_character_flag = hanami_garden_improvement_self_gardener
		clr_character_flag = hanami_weeds
		clr_character_flag = hanami_shirabyoshi_event
		clr_character_flag = hanami_shirabyoshi
		clr_character_flag = hanami_no_entertainers
		clr_character_flag = lavishly_food
		clr_character_flag = medium_food
		clr_character_flag = low_food
		clr_character_flag = sent_invitations
		clr_character_flag = shirabyoshi_noshow
		clr_character_flag = bad_shirabyoshi
		clr_character_flag = inspiring_shirabyoshi
		clr_character_flag = troublesome_shirabyoshi
		clr_character_flag = remarkable_shirabyoshi
		clr_character_flag = banished_shirabyoshi
		clr_character_flag = shirabyoshi_killed
		clr_character_flag = hanami_duel_challengee_won
		clr_character_flag = hanami_duel_draw
		clr_character_flag = hanami_duel_challenger_won
		clr_character_flag = hanami_in_progress
		clr_character_flag = hanami_good_weather
		clr_character_flag = hanami_shirabyoshi_duel_hold_back
		clr_character_flag = hanami_shirabyoshi_duel_fair_fight
		clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
		clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
		clr_character_flag = hanami_brave
		clr_character_flag = hanami_not_craven
		clr_character_flag = hanami_prestige
		clr_character_flag = hanami_wounded
		clr_character_flag = hanami_duelist
		clr_character_flag = do_not_disturb
		clr_character_flag = won_shirabyoshi_duel
		any_vassal = {
			limit = {
				has_character_flag = guest_hanami_started
			}
			clr_character_flag = coming_to_hanami
			clr_character_flag = guest_hanami_started
			clr_character_flag = hanami_shirabyoshi_duel_hold_back
			clr_character_flag = hanami_shirabyoshi_duel_fair_fight
			clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
			clr_character_flag = hanami_brave
			clr_character_flag = hanami_not_craven
			clr_character_flag = hanami_prestige
			clr_character_flag = hanami_wounded
			clr_character_flag = hanami_duelist
			clr_character_flag = shirabyoshi_dueller
			clr_character_flag = won_shirabyoshi_duel
		}
		any_courtier = {
			clr_character_flag = coming_to_hanami
			clr_character_flag = guest_hanami_started
			clr_character_flag = hanami_shirabyoshi_duel_hold_back
			clr_character_flag = hanami_shirabyoshi_duel_fair_fight
			clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
			clr_character_flag = hanami_brave
			clr_character_flag = hanami_not_craven
			clr_character_flag = hanami_prestige
			clr_character_flag = hanami_wounded
			clr_character_flag = hanami_duelist
			clr_character_flag = shirabyoshi_dueller
			clr_character_flag = won_shirabyoshi_duel
		}
	}
}